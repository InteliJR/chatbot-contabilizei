<!doctype html>
<html lang="pt-br" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-DocumentaÃ§Ãµes de Desenvolvimento/Guia_teste_pipeline_documentos" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Guia de VerificaÃ§Ã£o â€” API de Conhecimento RAG + Sistema de Testes | Consultor ContÃ¡bil de IA Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://InteliJR.github.io/chatbot-contabilizei/docs/DocumentaÃ§Ãµes de Desenvolvimento/Guia_teste_pipeline_documentos"><meta data-rh="true" property="og:locale" content="pt_br"><meta data-rh="true" name="docusaurus_locale" content="pt-br"><meta data-rh="true" name="docsearch:language" content="pt-br"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Guia de VerificaÃ§Ã£o â€” API de Conhecimento RAG + Sistema de Testes | Consultor ContÃ¡bil de IA Docs"><meta data-rh="true" name="description" content="Este documento consolida o guia operacional da API (endpoints, curl, Swagger, Postman, GCP) e o"><meta data-rh="true" property="og:description" content="Este documento consolida o guia operacional da API (endpoints, curl, Swagger, Postman, GCP) e o"><link data-rh="true" rel="icon" href="/chatbot-contabilizei/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://InteliJR.github.io/chatbot-contabilizei/docs/DocumentaÃ§Ãµes de Desenvolvimento/Guia_teste_pipeline_documentos"><link data-rh="true" rel="alternate" href="https://InteliJR.github.io/chatbot-contabilizei/docs/DocumentaÃ§Ãµes de Desenvolvimento/Guia_teste_pipeline_documentos" hreflang="pt-br"><link data-rh="true" rel="alternate" href="https://InteliJR.github.io/chatbot-contabilizei/docs/DocumentaÃ§Ãµes de Desenvolvimento/Guia_teste_pipeline_documentos" hreflang="x-default"><link rel="stylesheet" href="/chatbot-contabilizei/assets/css/styles.73157cf8.css">
<script src="/chatbot-contabilizei/assets/js/runtime~main.35d064e7.js" defer="defer"></script>
<script src="/chatbot-contabilizei/assets/js/main.30bee200.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Pular para o conteÃºdo principal"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Pular para o conteÃºdo principal</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Alternar a barra de navegaÃ§Ã£o" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/chatbot-contabilizei/"><b class="navbar__title text--truncate">InÃ­cio</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/chatbot-contabilizei/docs/intro">DocumentaÃ§Ã£o</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Alterar entre os modos claro e escuro (modo modo claro ativado)" aria-label="Alterar entre os modos claro e escuro (modo modo claro ativado)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Volte para o topo" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/chatbot-contabilizei/docs/intro">InÃ­cio</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/chatbot-contabilizei/docs/design">ğŸ¨ Design</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/chatbot-contabilizei/docs/tecnologias">âš™ï¸ Tecnologias</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/chatbot-contabilizei/docs/desenvolvimento">ğŸ’» Desenvolvimento</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/chatbot-contabilizei/docs/DocumentaÃ§Ãµes de Desenvolvimento/Guia_teste_pipeline_documentos">DocumentaÃ§Ãµes de Desenvolvimento</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/chatbot-contabilizei/docs/DocumentaÃ§Ãµes de Desenvolvimento/Guia_teste_pipeline_documentos">Guia de VerificaÃ§Ã£o â€” API de Conhecimento RAG + Sistema de Testes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/chatbot-contabilizei/docs/DocumentaÃ§Ãµes de Desenvolvimento/arquitetura_ELT_blog">DocumentaÃ§Ã£o TÃ©cnica: Pipeline de IngestÃ£o de Artigos (ETL Blog)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/chatbot-contabilizei/docs/DocumentaÃ§Ãµes de Desenvolvimento/arquitetura_ELT_conversa">DocumentaÃ§Ã£o TÃ©cnica: Pipeline de IngestÃ£o de Conhecimento (ETL de Conversas)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/chatbot-contabilizei/docs/DocumentaÃ§Ãµes de Desenvolvimento/arquitetura_geral_detalhada">Arquitetura TÃ©cnica do Sistema RAG: Agente de InteligÃªncia Contabilizei</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/chatbot-contabilizei/docs/DocumentaÃ§Ãµes de Desenvolvimento/deploy">Deploy para Google Cloud Run</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/chatbot-contabilizei/docs/DocumentaÃ§Ãµes de Desenvolvimento/testes-e-seguranca">ğŸ”’ SeguranÃ§a e Testes</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/chatbot-contabilizei/docs/visao-produto">ğŸ“„ VisÃ£o de Produto</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="PÃ¡gina Inicial" class="breadcrumbs__link" href="/chatbot-contabilizei/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">DocumentaÃ§Ãµes de Desenvolvimento</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Guia de VerificaÃ§Ã£o â€” API de Conhecimento RAG + Sistema de Testes</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Nessa pÃ¡gina</button></div><div class="theme-doc-markdown markdown"><header><h1>Guia de VerificaÃ§Ã£o â€” API de Conhecimento RAG + Sistema de Testes</h1></header>
<p>Este documento consolida o guia operacional da API (endpoints, curl, Swagger, Postman, GCP) e o
manual tÃ©cnico do sistema de testes automatizados em um Ãºnico ponto de referÃªncia.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="estatÃ­sticas-do-sistema-de-testes">EstatÃ­sticas do Sistema de Testes<a href="#estatÃ­sticas-do-sistema-de-testes" class="hash-link" aria-label="Link direto para EstatÃ­sticas do Sistema de Testes" title="Link direto para EstatÃ­sticas do Sistema de Testes">â€‹</a></h2>
<table><thead><tr><th>MÃ©trica</th><th>Valor Atual</th><th>Target</th></tr></thead><tbody><tr><td>Total de Testes</td><td><strong>96</strong></td><td>â‰¥ 95</td></tr><tr><td>Taxa de Sucesso</td><td><strong>100%</strong> (96/96)</td><td>100%</td></tr><tr><td>Cobertura de CÃ³digo</td><td><strong>88.53%</strong></td><td>â‰¥ 70%</td></tr><tr><td>Tempo de ExecuÃ§Ã£o</td><td>~10s</td><td>&lt; 30s</td></tr><tr><td>Testes UnitÃ¡rios</td><td>~76</td><td>â€”</td></tr><tr><td>Testes de IntegraÃ§Ã£o</td><td>~20</td><td>â€”</td></tr></tbody></table>
<p><strong>Tecnologias de Teste:</strong></p>
<ul>
<li>Framework: pytest 7.4.3+</li>
<li>Cobertura: coverage.py</li>
<li>Async: pytest-asyncio</li>
<li>Threshold mÃ­nimo: 70% (configurado em <code>pytest.ini</code>)</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-testes-automatizados">1. Testes Automatizados<a href="#1-testes-automatizados" class="hash-link" aria-label="Link direto para 1. Testes Automatizados" title="Link direto para 1. Testes Automatizados">â€‹</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-execuÃ§Ã£o-bÃ¡sica">1.1 ExecuÃ§Ã£o BÃ¡sica<a href="#11-execuÃ§Ã£o-bÃ¡sica" class="hash-link" aria-label="Link direto para 1.1 ExecuÃ§Ã£o BÃ¡sica" title="Link direto para 1.1 ExecuÃ§Ã£o BÃ¡sica">â€‹</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd arquitetura_RAG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Todos os testes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./venv/bin/pytest tests/ -v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Por tipo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./venv/bin/pytest -m unit -v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./venv/bin/pytest -m integration -v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./venv/bin/pytest -m critical -v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># End-to-End</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./venv/bin/pytest tests/integration/test_e2e_knowledge_lifecycle.py -v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Sem cobertura (mais rÃ¡pido)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./venv/bin/pytest tests/ -v --no-cov</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-execuÃ§Ã£o-avanÃ§ada">1.2 ExecuÃ§Ã£o AvanÃ§ada<a href="#12-execuÃ§Ã£o-avanÃ§ada" class="hash-link" aria-label="Link direto para 1.2 ExecuÃ§Ã£o AvanÃ§ada" title="Link direto para 1.2 ExecuÃ§Ã£o AvanÃ§ada">â€‹</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Arquivo especÃ­fico</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./venv/bin/pytest tests/unit/test_chunking.py -v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Teste especÃ­fico</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./venv/bin/pytest tests/unit/test_chunking.py::TestSafeRecursiveSplit::test_table_not_broken -v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Modo silencioso</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./venv/bin/pytest tests/ -q</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Parar no primeiro erro</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./venv/bin/pytest tests/ -x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Reexecutar apenas testes que falharam</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./venv/bin/pytest --lf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Com cobertura e relatÃ³rio HTML</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./venv/bin/pytest tests/ --cov --cov-report=html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xdg-open htmlcov/index.html  # Linux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># RelatÃ³rio de cobertura no terminal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./venv/bin/pytest tests/ --cov --cov-report=term-missing</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="13-estrutura-de-diretÃ³rios">1.3 Estrutura de DiretÃ³rios<a href="#13-estrutura-de-diretÃ³rios" class="hash-link" aria-label="Link direto para 1.3 Estrutura de DiretÃ³rios" title="Link direto para 1.3 Estrutura de DiretÃ³rios">â€‹</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">arquitetura_RAG/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ tests/                                    # DiretÃ³rio principal de testes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”œâ”€â”€ conftest.py                           # Fixtures compartilhadas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”œâ”€â”€ __init__.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”œâ”€â”€ unit/                                 # Testes unitÃ¡rios</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”‚   â”œâ”€â”€ __init__.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”‚   â”œâ”€â”€ test_chunking.py                  # Chunking de documentos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”‚   â”œâ”€â”€ test_retrieval_logic.py           # LÃ³gica de busca RAG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”‚   â”œâ”€â”€ test_embeddings.py                # GeraÃ§Ã£o de embeddings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”‚   â”œâ”€â”€ test_llm_metadata.py              # InferÃªncia de metadados via LLM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”‚   â”œâ”€â”€ test_url_fetcher.py               # Fetch e parse de URLs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”‚   â”œâ”€â”€ test_vertex_service.py            # Upsert/search/delete no Vertex AI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”‚   â””â”€â”€ test_firestore_service.py         # CRUD no Firestore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â””â”€â”€ integration/                          # Testes de integraÃ§Ã£o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚       â”œâ”€â”€ __init__.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚       â”œâ”€â”€ test_api_contract.py              # Contrato dos endpoints</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚       â””â”€â”€ test_e2e_knowledge_lifecycle.py   # Ciclo completo: ingestâ†’chatâ†’delete</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ pytest.ini                                # ConfiguraÃ§Ã£o do pytest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ requirements-dev.txt                      # DependÃªncias de teste</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ htmlcov/                                  # RelatÃ³rios de cobertura HTML (gerado)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€â”€ .coverage                                 # Banco de dados de cobertura (gerado)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="pytestini">pytest.ini<a href="#pytestini" class="hash-link" aria-label="Link direto para pytest.ini" title="Link direto para pytest.ini">â€‹</a></h4>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[pytest]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">testpaths = tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python_files = test_*.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python_classes = Test*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python_functions = test_*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">addopts =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --verbose</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --strict-markers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --color=yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --tb=short</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --cov=app_rag</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --cov-fail-under=70</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">markers =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unit: Testes unitÃ¡rios</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    integration: Testes de integraÃ§Ã£o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    critical: Testes de funcionalidades crÃ­ticas</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="14-mÃ³dulos-de-teste-detalhados">1.4 MÃ³dulos de Teste Detalhados<a href="#14-mÃ³dulos-de-teste-detalhados" class="hash-link" aria-label="Link direto para 1.4 MÃ³dulos de Teste Detalhados" title="Link direto para 1.4 MÃ³dulos de Teste Detalhados">â€‹</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="test_chunkingpy">test_chunking.py<a href="#test_chunkingpy" class="hash-link" aria-label="Link direto para test_chunking.py" title="Link direto para test_chunking.py">â€‹</a></h4>
<p><strong>Arquivo testado:</strong> <code>app_rag/services/chunking.py</code></p>
<p><strong>FunÃ§Ãµes testadas:</strong> <code>smart_parent_split()</code>, <code>smart_recursive_split()</code></p>
<p><strong>Justificativa:</strong> Tabelas tributÃ¡rias nÃ£o podem ser quebradas no meio â€” isso levaria a informaÃ§Ãµes incorretas no RAG.</p>
<table><thead><tr><th>Teste</th><th>DescriÃ§Ã£o</th><th>Marcador</th></tr></thead><tbody><tr><td><code>test_parent_split_respects_limit</code></td><td>Nenhum parent excede 6000 chars</td><td>unit</td></tr><tr><td><code>test_parent_split_prefers_paragraph_breaks</code></td><td>Quebras preferem parÃ¡grafos, nÃ£o meio de frases</td><td>unit</td></tr><tr><td><code>test_chunks_respect_size_limit</code></td><td>Chunks nÃ£o excedem 800 chars</td><td>unit</td></tr><tr><td><code>test_chunks_have_overlap</code></td><td>Overlap de 200 chars preserva contexto</td><td>unit</td></tr><tr><td><code>test_table_not_broken</code></td><td>Tabelas Markdown permanecem Ã­ntegras</td><td>unit, <strong>critical</strong></td></tr><tr><td><code>test_empty_text_handling</code></td><td>Strings vazias nÃ£o geram exceÃ§Ãµes</td><td>unit</td></tr><tr><td><code>test_very_short_text_not_chunked</code></td><td>Textos &lt; chunk_size nÃ£o sÃ£o divididos</td><td>unit</td></tr></tbody></table>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pytest tests/unit/test_chunking.py -v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pytest tests/unit/test_chunking.py::TestSafeRecursiveSplit::test_table_not_broken -v</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="test_retrieval_logicpy">test_retrieval_logic.py<a href="#test_retrieval_logicpy" class="hash-link" aria-label="Link direto para test_retrieval_logic.py" title="Link direto para test_retrieval_logic.py">â€‹</a></h4>
<p><strong>Arquivo testado:</strong> <code>app_rag/main.py</code></p>
<p><strong>FunÃ§Ã£o testada:</strong> <code>retrieve_context(query_vector, k=5, filtro_tipo=None)</code></p>
<p><strong>Justificativa:</strong> NÃºcleo do RAG. Implementa busca vetorial, boost para blogs, threshold e deduplicaÃ§Ã£o.</p>
<table><thead><tr><th>Teste</th><th>DescriÃ§Ã£o</th><th>Marcador</th></tr></thead><tbody><tr><td><code>test_blog_boost_applied_correctly</code></td><td>Blogs recebem boost de 15% (0.70 â†’ 0.805)</td><td>unit, <strong>critical</strong></td></tr><tr><td><code>test_threshold_minimum_score</code></td><td>Documentos com score &lt; 0.50 sÃ£o descartados</td><td>unit, <strong>critical</strong></td></tr><tr><td><code>test_parent_deduplication</code></td><td>MÃºltiplos chunks do mesmo parent: mantÃ©m sÃ³ o de maior score</td><td>unit, <strong>critical</strong></td></tr><tr><td><code>test_filter_by_type_blog</code></td><td>Filtro por tipo &quot;blog&quot; funciona</td><td>unit</td></tr><tr><td><code>test_filter_by_type_conversa</code></td><td>Filtro por tipo &quot;conversa&quot; funciona</td><td>unit</td></tr><tr><td><code>test_empty_results_from_vertex</code></td><td>Resultados vazios sem exceÃ§Ãµes</td><td>unit</td></tr><tr><td><code>test_top_k_limit_respected</code></td><td>ParÃ¢metro k limita nÃºmero de documentos</td><td>unit</td></tr></tbody></table>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pytest tests/unit/test_retrieval_logic.py -v</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="test_embeddingspy">test_embeddings.py<a href="#test_embeddingspy" class="hash-link" aria-label="Link direto para test_embeddings.py" title="Link direto para test_embeddings.py">â€‹</a></h4>
<p><strong>Arquivo testado:</strong> <code>app_rag/services/embedding.py</code></p>
<p><strong>FunÃ§Ãµes testadas:</strong> <code>get_embedding()</code>, <code>get_embeddings_batch()</code></p>
<table><thead><tr><th>Teste</th><th>DescriÃ§Ã£o</th><th>Marcador</th></tr></thead><tbody><tr><td><code>test_newlines_replaced_by_space</code></td><td><code>\n</code> substituÃ­dos antes de envio Ã  API</td><td>unit</td></tr><tr><td><code>test_returns_1536_dimensions</code></td><td>Embedding retorna vetor de 1536 dimensÃµes</td><td>unit</td></tr><tr><td><code>test_empty_text_handling</code></td><td>Texto vazio Ã© enviado ao cliente e retorna embedding normalmente (contrato determinÃ­stico)</td><td>unit</td></tr><tr><td><code>test_batch_returns_correct_count</code></td><td>Batch retorna 1 embedding por texto</td><td>unit</td></tr><tr><td><code>test_batch_replaces_newlines</code></td><td>Batch substitui <code>\n</code> em todos os textos</td><td>unit</td></tr></tbody></table>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pytest tests/unit/test_embeddings.py -v</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="test_llm_metadatapy">test_llm_metadata.py<a href="#test_llm_metadatapy" class="hash-link" aria-label="Link direto para test_llm_metadata.py" title="Link direto para test_llm_metadata.py">â€‹</a></h4>
<p><strong>Arquivo testado:</strong> <code>app_rag/services/llm_metadata.py</code></p>
<p><strong>FunÃ§Ãµes testadas:</strong> <code>infer_blog_metadata()</code>, <code>infer_qa_metadata()</code></p>
<p><strong>Justificativa:</strong> Valida que a inferÃªncia de metadados via LLM (gpt-4o-mini) retorna <code>BlogMetadata</code> e <code>QAMetadata</code> com os campos corretos, mockando o cliente OpenAI.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pytest tests/unit/test_llm_metadata.py -v</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="test_url_fetcherpy">test_url_fetcher.py<a href="#test_url_fetcherpy" class="hash-link" aria-label="Link direto para test_url_fetcher.py" title="Link direto para test_url_fetcher.py">â€‹</a></h4>
<p><strong>Arquivo testado:</strong> <code>app_rag/services/url_fetcher.py</code></p>
<p><strong>FunÃ§Ã£o testada:</strong> <code>fetch_url_content(url)</code> â†’ retorna <code>UrlContent(text, title)</code></p>
<p><strong>Justificativa:</strong> Valida fetch de URL, conversÃ£o HTMLâ†’Markdown, proteÃ§Ã£o anti-SSRF (<code>_validate_url</code> bloqueia hosts internos e protocolos nÃ£o-HTTP) e tratamento de URLs invÃ¡lidas ou indisponÃ­veis.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pytest tests/unit/test_url_fetcher.py -v</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="test_vertex_servicepy">test_vertex_service.py<a href="#test_vertex_servicepy" class="hash-link" aria-label="Link direto para test_vertex_service.py" title="Link direto para test_vertex_service.py">â€‹</a></h4>
<p><strong>Arquivo testado:</strong> <code>app_rag/services/vertex_service.py</code></p>
<p><strong>FunÃ§Ãµes testadas:</strong> <code>upsert_datapoints()</code>, <code>remove_datapoints()</code>, <code>search_neighbors()</code></p>
<p><strong>Justificativa:</strong> Valida operaÃ§Ãµes no Vertex AI Vector Search mockando o endpoint, verificando formato de datapoints e tratamento de erros.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pytest tests/unit/test_vertex_service.py -v</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="test_firestore_servicepy">test_firestore_service.py<a href="#test_firestore_servicepy" class="hash-link" aria-label="Link direto para test_firestore_service.py" title="Link direto para test_firestore_service.py">â€‹</a></h4>
<p><strong>Arquivo testado:</strong> <code>app_rag/services/firestore_service.py</code></p>
<p><strong>FunÃ§Ãµes testadas:</strong> <code>create_document()</code>, <code>get_document()</code>, <code>delete_document()</code>, <code>find_documents_by_base_article_id()</code>, <code>list_documents()</code></p>
<p><strong>Justificativa:</strong> Valida CRUD no Firestore (<code>rag-db-v1</code>, collection <code>knowledge_base</code>) mockando o cliente. Inclui testes de mapeamento dos filtros de tipo:</p>
<ul>
<li><code>tipo=blog</code> â†’ <code>WHERE type == &quot;blog_section&quot;</code></li>
<li><code>tipo=conversa</code> â†’ <code>WHERE type != &quot;blog_section&quot;</code> (inclui todos os nÃ£o-blog)</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pytest tests/unit/test_firestore_service.py -v</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="test_api_contractpy">test_api_contract.py<a href="#test_api_contractpy" class="hash-link" aria-label="Link direto para test_api_contract.py" title="Link direto para test_api_contract.py">â€‹</a></h4>
<p><strong>Arquivo testado:</strong> <code>app_rag/main.py</code></p>
<p><strong>Endpoints testados:</strong> <code>/knowledge/ingest/blog</code>, <code>/knowledge/ingest/qa</code>, <code>/knowledge/delete</code>, <code>GET /knowledge</code>, <code>/chat</code></p>
<p><strong>Justificativa:</strong> Valida o contrato completo da API â€” campos de request/response, status codes e comportamento dos endpoints.</p>
<table><thead><tr><th>Teste</th><th>DescriÃ§Ã£o</th><th>Marcador</th></tr></thead><tbody><tr><td><code>test_chat_endpoint_valid_request</code></td><td>Request vÃ¡lido retorna <code>fontes</code></td><td>integration, <strong>critical</strong></td></tr><tr><td><code>test_response_structure</code></td><td>Response tem campo <code>fontes</code>, sem campo <code>resposta</code></td><td>integration</td></tr><tr><td><code>test_fontes_structure</code></td><td>Cada fonte tem id, score, conteudo, titulo, tipo</td><td>integration</td></tr><tr><td><code>test_filtro_tipo_blog_applied</code></td><td>Filtro por tipo &quot;blog&quot; Ã© aplicado</td><td>integration</td></tr><tr><td><code>test_no_results_returns_empty_fontes</code></td><td>Sem resultados retorna <code>{&quot;fontes&quot;: []}</code></td><td>integration</td></tr></tbody></table>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pytest tests/integration/test_api_contract.py -v</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="test_e2e_knowledge_lifecyclepy">test_e2e_knowledge_lifecycle.py<a href="#test_e2e_knowledge_lifecyclepy" class="hash-link" aria-label="Link direto para test_e2e_knowledge_lifecycle.py" title="Link direto para test_e2e_knowledge_lifecycle.py">â€‹</a></h4>
<p><strong>Arquivo testado:</strong> <code>app_rag/main.py</code> (fluxo completo)</p>
<p><strong>Justificativa:</strong> Testa o ciclo completo (ingestÃ£o â†’ busca â†’ exclusÃ£o â†’ verificaÃ§Ã£o de remoÃ§Ã£o), mockando apenas as APIs externas.</p>
<table><thead><tr><th>Classe</th><th>Teste</th><th>DescriÃ§Ã£o</th><th>Marcador</th></tr></thead><tbody><tr><td><code>TestKnowledgeLifecycleE2E</code></td><td><code>test_qa_ingest_then_chat_then_delete</code></td><td>Ciclo completo Q&amp;A</td><td>integration, <strong>critical</strong></td></tr><tr><td><code>TestKnowledgeLifecycleE2E</code></td><td><code>test_artigo_ingest_then_chat_then_delete</code></td><td>Ciclo completo Artigo</td><td>integration, <strong>critical</strong></td></tr><tr><td><code>TestPerformanceMetrics</code></td><td><code>test_qa_ingest_under_5_seconds</code></td><td>Q&amp;A ingestÃ£o &lt; 5s</td><td>integration</td></tr><tr><td><code>TestPerformanceMetrics</code></td><td><code>test_artigo_ingest_under_30_seconds</code></td><td>Artigo ingestÃ£o &lt; 30s</td><td>integration</td></tr><tr><td><code>TestChatRegression</code></td><td><code>test_chat_with_blog_result</code></td><td>Chat com resultado blog</td><td>integration</td></tr><tr><td><code>TestChatRegression</code></td><td><code>test_chat_with_conversa_result</code></td><td>Chat com resultado conversa</td><td>integration</td></tr><tr><td><code>TestChatRegression</code></td><td><code>test_chat_no_results_graceful</code></td><td>Chat sem resultados</td><td>integration</td></tr></tbody></table>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pytest tests/integration/test_e2e_knowledge_lifecycle.py -v</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="15-fixtures-e-mocking">1.5 Fixtures e Mocking<a href="#15-fixtures-e-mocking" class="hash-link" aria-label="Link direto para 1.5 Fixtures e Mocking" title="Link direto para 1.5 Fixtures e Mocking">â€‹</a></h3>
<p>Fixtures definidas em <code>tests/conftest.py</code> e injetadas automaticamente pelo pytest.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="fixtures-de-mocks">Fixtures de Mocks<a href="#fixtures-de-mocks" class="hash-link" aria-label="Link direto para Fixtures de Mocks" title="Link direto para Fixtures de Mocks">â€‹</a></h4>
<table><thead><tr><th>Fixture</th><th>O que simula</th></tr></thead><tbody><tr><td><code>mock_firestore_client</code></td><td>Cliente Firestore (sem acesso real ao banco)</td></tr><tr><td><code>mock_vertex_endpoint</code></td><td>Vertex AI Endpoint (upsert, search, remove)</td></tr><tr><td><code>mock_openai_client</code></td><td>Cliente OpenAI (embeddings, chat completions)</td></tr></tbody></table>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">test_exemplo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mock_openai_client</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mock_openai_client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">embeddings</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">create</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">return_value</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">embedding </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0.1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1536</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ... teste ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="fixtures-de-dados">Fixtures de Dados<a href="#fixtures-de-dados" class="hash-link" aria-label="Link direto para Fixtures de Dados" title="Link direto para Fixtures de Dados">â€‹</a></h4>
<table><thead><tr><th>Fixture</th><th>Retorna</th></tr></thead><tbody><tr><td><code>sample_query_vector</code></td><td>Lista de 1536 floats</td></tr><tr><td><code>sample_blog_document</code></td><td>Dict com estrutura de documento de blog</td></tr><tr><td><code>sample_conversa_document</code></td><td>Dict com estrutura de conversa</td></tr><tr><td><code>sample_vertex_neighbors</code></td><td>Lista de neighbors mockados</td></tr><tr><td><code>sample_source_docs</code></td><td>Lista de objetos <code>SourceDoc</code></td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="padrÃ£o-de-mocking-com-patch">PadrÃ£o de Mocking com <code>@patch</code><a href="#padrÃ£o-de-mocking-com-patch" class="hash-link" aria-label="Link direto para padrÃ£o-de-mocking-com-patch" title="Link direto para padrÃ£o-de-mocking-com-patch">â€‹</a></h4>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token decorator annotation punctuation" style="color:#393A34">@patch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;main.search_neighbors&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@patch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;main.get_embedding&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@pytest</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">mark</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">asyncio</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">test_exemplo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> mock_embed</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> mock_search</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mock_embed</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">return_value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0.1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1536</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mock_search</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">return_value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Mock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;doc1_chk0&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> distance</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.85</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> chat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ChatRequest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pergunta</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Teste?&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">assert</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fontes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="padrÃ£o-aaa">PadrÃ£o AAA<a href="#padrÃ£o-aaa" class="hash-link" aria-label="Link direto para PadrÃ£o AAA" title="Link direto para PadrÃ£o AAA">â€‹</a></h4>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">test_exemplo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ARRANGE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entrada </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;valor de teste&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    esperado </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;resultado esperado&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ACT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resultado </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> funcao</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">entrada</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ASSERT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">assert</span><span class="token plain"> resultado </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> esperado</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="16-cobertura-de-cÃ³digo">1.6 Cobertura de CÃ³digo<a href="#16-cobertura-de-cÃ³digo" class="hash-link" aria-label="Link direto para 1.6 Cobertura de CÃ³digo" title="Link direto para 1.6 Cobertura de CÃ³digo">â€‹</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># RelatÃ³rio no terminal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./venv/bin/pytest tests/ --cov --cov-report=term-missing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># RelatÃ³rio HTML interativo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./venv/bin/pytest tests/ --cov --cov-report=html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xdg-open htmlcov/index.html</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Status atual:</strong> 88.53% (acima do threshold de 70%).</p>
<p><strong>InterpretaÃ§Ã£o do relatÃ³rio:</strong></p>
<ul>
<li><strong>Stmts:</strong> Total de linhas de cÃ³digo</li>
<li><strong>Miss:</strong> Linhas nÃ£o testadas</li>
<li><strong>Cover:</strong> Porcentagem de cobertura</li>
<li><strong>Missing:</strong> NÃºmeros das linhas nÃ£o testadas</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="17-resoluÃ§Ã£o-de-problemas">1.7 ResoluÃ§Ã£o de Problemas<a href="#17-resoluÃ§Ã£o-de-problemas" class="hash-link" aria-label="Link direto para 1.7 ResoluÃ§Ã£o de Problemas" title="Link direto para 1.7 ResoluÃ§Ã£o de Problemas">â€‹</a></h3>
<table><thead><tr><th>Problema</th><th>Causa</th><th>SoluÃ§Ã£o</th></tr></thead><tbody><tr><td><code>pytest: command not found</code></td><td>venv nÃ£o ativado</td><td><code>source venv/bin/activate</code> ou usar <code>./venv/bin/pytest</code></td></tr><tr><td><code>ModuleNotFoundError: No module named &#x27;pytest&#x27;</code></td><td>pytest nÃ£o instalado no venv</td><td><code>./venv/bin/pip install -r requirements-dev.txt</code></td></tr><tr><td><code>FileNotFoundError: pytest.ini</code></td><td>Executando pytest no diretÃ³rio errado</td><td>Executar a partir de <code>arquitetura_RAG/</code></td></tr><tr><td><code>ImportError: cannot import name &#x27;X&#x27;</code></td><td>Caminho incorreto para mÃ³dulo</td><td>Verificar <code>sys.path.insert</code> no topo dos arquivos de teste</td></tr><tr><td><code>Coverage.py warning: No data was collected</code></td><td>ConfiguraÃ§Ã£o incorreta</td><td>Verificar <code>pytest.ini</code> e rodar <code>pytest --collect-only</code></td></tr><tr><td><code>FAILED coverage: 70% not reached</code></td><td>Cobertura abaixo do threshold</td><td>Adicionar mais testes ou usar <code>--no-cov-fail</code> temporariamente</td></tr><tr><td><code>PermissionError: htmlcov/index.html</code></td><td>Arquivo aberto em outro programa</td><td><code>rm -rf htmlcov/ &amp;&amp; pytest tests/ --cov --cov-report=html</code></td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="18-boas-prÃ¡ticas">1.8 Boas PrÃ¡ticas<a href="#18-boas-prÃ¡ticas" class="hash-link" aria-label="Link direto para 1.8 Boas PrÃ¡ticas" title="Link direto para 1.8 Boas PrÃ¡ticas">â€‹</a></h3>
<p><strong>Antes de commitar:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./venv/bin/pytest tests/ -v          # todos os testes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./venv/bin/pytest tests/ --cov       # verificar cobertura</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Nomenclatura:</strong></p>
<ul>
<li>Arquivos: <code>test_*.py</code></li>
<li>Classes: <code>Test*</code></li>
<li>FunÃ§Ãµes: <code>test_*</code></li>
<li>Nomes descritivos do comportamento testado (ex: <code>test_blog_boost_applied_correctly</code>)</li>
</ul>
<p><strong>Marcadores â€” sempre categorizar:</strong></p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token decorator annotation punctuation" style="color:#393A34">@pytest</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">mark</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">unit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@pytest</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">mark</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">critical</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">test_funcionalidade_critica</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    DescriÃ§Ã£o do que estÃ¡ sendo testado.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    CenÃ¡rio: entrada â†’ saÃ­da esperada.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Mocking â€” nunca acessar APIs externas nos testes:</strong></p>
<ul>
<li>Usar <code>@patch(&#x27;main.funcao&#x27;)</code> para serviÃ§os (OpenAI, Firestore, Vertex AI)</li>
<li>Fixtures em <code>conftest.py</code> para dados reutilizÃ¡veis</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-iniciar-a-api-localmente">2. Iniciar a API Localmente<a href="#2-iniciar-a-api-localmente" class="hash-link" aria-label="Link direto para 2. Iniciar a API Localmente" title="Link direto para 2. Iniciar a API Localmente">â€‹</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd arquitetura_RAG/app_rag</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">../venv/bin/uvicorn main:app --reload --port 8000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Swagger UI: <strong><a href="http://localhost:8000/docs" target="_blank" rel="noopener noreferrer">http://localhost:8000/docs</a></strong></li>
<li>OpenAPI JSON: <strong><a href="http://localhost:8000/openapi.json" target="_blank" rel="noopener noreferrer">http://localhost:8000/openapi.json</a></strong></li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-mapa-de-endpoints">3. Mapa de Endpoints<a href="#3-mapa-de-endpoints" class="hash-link" aria-label="Link direto para 3. Mapa de Endpoints" title="Link direto para 3. Mapa de Endpoints">â€‹</a></h2>
<table><thead><tr><th>#</th><th>Metodo</th><th>Rota</th><th>Descricao</th></tr></thead><tbody><tr><td>1</td><td>POST</td><td><code>/knowledge/ingest/blog</code></td><td>Ingestao de artigo (URL, arquivo ou texto). LLM infere metadados.</td></tr><tr><td>2</td><td>POST</td><td><code>/knowledge/ingest/qa</code></td><td>Ingestao de Q&amp;A (arquivo ou texto). LLM infere metadados.</td></tr><tr><td>3</td><td>POST</td><td><code>/knowledge/delete</code></td><td>Exclusao unificada (1 ou mais IDs separados por virgula)</td></tr><tr><td>4</td><td>GET</td><td><code>/knowledge</code></td><td>Listagem com paginacao</td></tr><tr><td>5</td><td>POST</td><td><code>/chat</code></td><td>Busca RAG â€” retorna apenas fontes (sem resposta LLM)</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fluxo-de-ingestao">Fluxo de ingestao<a href="#fluxo-de-ingestao" class="hash-link" aria-label="Link direto para Fluxo de ingestao" title="Link direto para Fluxo de ingestao">â€‹</a></h3>
<p>Ambos os endpoints de ingestao chamam o LLM automaticamente para inferir os metadados (titulo, categoria, tags). Para blogs, o LLM tambem reestrutura o conteudo em markdown limpo.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-testes-via-terminal-curl">4. Testes via Terminal (curl)<a href="#4-testes-via-terminal-curl" class="hash-link" aria-label="Link direto para 4. Testes via Terminal (curl)" title="Link direto para 4. Testes via Terminal (curl)">â€‹</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-ingerir-blog-via-url">4.1 Ingerir Blog via URL<a href="#41-ingerir-blog-via-url" class="hash-link" aria-label="Link direto para 4.1 Ingerir Blog via URL" title="Link direto para 4.1 Ingerir Blog via URL">â€‹</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -s -X POST http://localhost:8000/knowledge/ingest/blog \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -F &quot;url=https://contabilizei.com.br/contabilidade/o-que-e-contabilidade&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | python3 -m json.tool</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Resposta esperada:</strong></p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;status&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;success&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;message&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Artigo ingerido com sucesso&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;documento&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;api_ingest_20260217XXXXXX_Titulo_Inferido_pela_LLM&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;tipo&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;artigo&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;titulo&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Titulo extraido pela LLM da pagina&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;categoria&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Contabilidade&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;tags&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;contabilidade&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;empresa&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CNPJ&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;chunks_criados&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;vetores_criados&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;parents_criados&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;resumo&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Resumo gerado pela LLM em 2-3 linhas.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-ingerir-blog-via-arquivo">4.2 Ingerir Blog via Arquivo<a href="#42-ingerir-blog-via-arquivo" class="hash-link" aria-label="Link direto para 4.2 Ingerir Blog via Arquivo" title="Link direto para 4.2 Ingerir Blog via Arquivo">â€‹</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &gt; /tmp/artigo.md &lt;&lt; &#x27;EOF&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MEI: tudo o que voce precisa saber</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">O Microempreendedor Individual e a forma mais simples de formalizar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">um negocio no Brasil. Oferece CNPJ, emissao de nota fiscal e beneficios.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Quem pode ser MEI?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Profissionais que faturam ate R$81 mil por ano e atuam em atividades permitidas.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Quanto custa ser MEI?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">O DAS (boleto mensal) custa em torno de R$71 a R$75 por mes em 2026.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -s -X POST http://localhost:8000/knowledge/ingest/blog \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -F &quot;arquivo=@/tmp/artigo.md&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | python3 -m json.tool</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="43-ingerir-blog-via-texto-raw">4.3 Ingerir Blog via Texto Raw<a href="#43-ingerir-blog-via-texto-raw" class="hash-link" aria-label="Link direto para 4.3 Ingerir Blog via Texto Raw" title="Link direto para 4.3 Ingerir Blog via Texto Raw">â€‹</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -s -X POST http://localhost:8000/knowledge/ingest/blog \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -F &quot;conteudo=O Simples Nacional e um regime tributario simplificado para micro e pequenas empresas no Brasil. Ele unifica o pagamento de tributos em uma unica guia, o DAS. As empresas podem optar pelo Simples Nacional se tiverem faturamento ate R\$4,8 milhoes por ano.&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | python3 -m json.tool</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="44-ingerir-qa-via-texto-raw">4.4 Ingerir Q&amp;A via Texto Raw<a href="#44-ingerir-qa-via-texto-raw" class="hash-link" aria-label="Link direto para 4.4 Ingerir Q&amp;A via Texto Raw" title="Link direto para 4.4 Ingerir Q&amp;A via Texto Raw">â€‹</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -s -X POST http://localhost:8000/knowledge/ingest/qa \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -F &quot;conteudo=Pergunta: O que e o DAS do MEI? Resposta: O DAS (Documento de Arrecadacao do Simples Nacional) e o boleto mensal que todo MEI deve pagar para manter seu CNPJ ativo e ter acesso a beneficios previdenciarios. O valor em 2026 e de R\$71 para comercio e R\$75 para servicos.&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | python3 -m json.tool</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Resposta esperada:</strong></p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;status&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;success&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;message&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Conhecimento Q&amp;A ingerido com sucesso&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;documento&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;api_ingest_20260217XXXXXX_Titulo_Inferido_pela_LLM&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;tipo&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;qa&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;titulo&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;O que e o DAS do MEI e quanto custa&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;categoria&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Tributacao&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;tags&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;MEI&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;DAS&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;boleto&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;chunks_criados&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;vetores_criados&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;parents_criados&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token null keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;resumo&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token null keyword" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p><strong>ANOTE O ID RETORNADO</strong> â€” voce vai precisar dele para exclusao.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="45-ingerir-qa-via-upload-de-arquivo">4.5 Ingerir Q&amp;A via Upload de Arquivo<a href="#45-ingerir-qa-via-upload-de-arquivo" class="hash-link" aria-label="Link direto para 4.5 Ingerir Q&amp;A via Upload de Arquivo" title="Link direto para 4.5 Ingerir Q&amp;A via Upload de Arquivo">â€‹</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Pergunta: Qual o prazo do DAS? Resposta: O prazo e ate o dia 20 de cada mes. Se cair no fim de semana ou feriado, o prazo antecipa para o ultimo dia util anterior.&quot; &gt; /tmp/qa.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -s -X POST http://localhost:8000/knowledge/ingest/qa \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -F &quot;arquivo=@/tmp/qa.txt&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | python3 -m json.tool</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="46-verificar-no-chat">4.6 Verificar no /chat<a href="#46-verificar-no-chat" class="hash-link" aria-label="Link direto para 4.6 Verificar no /chat" title="Link direto para 4.6 Verificar no /chat">â€‹</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Busca que deve retornar as fontes do conteudo recem-ingerido</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -s -X POST http://localhost:8000/chat \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &quot;Content-Type: application/json&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -d &#x27;{&quot;pergunta&quot;: &quot;O que e o DAS do MEI?&quot;}&#x27; | python3 -m json.tool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Filtrar apenas por blog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -s -X POST http://localhost:8000/chat \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &quot;Content-Type: application/json&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -d &#x27;{&quot;pergunta&quot;: &quot;O que e o Simples Nacional?&quot;, &quot;filtro_tipo&quot;: &quot;blog&quot;}&#x27; | python3 -m json.tool</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Resposta esperada:</strong></p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;fontes&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;api_ingest_20260219XXXXXX_titulo_secao&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;score&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.92</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;conteudo&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Texto do chunk recuperado...&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;titulo&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Titulo do artigo&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;url&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://contabilizei.com.br/...&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;tipo&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;blog&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>O campo <code>resposta</code> foi removido â€” o agente consumidor e responsavel por gerar a resposta final com base nas fontes.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="47-listar-conhecimento">4.7 Listar Conhecimento<a href="#47-listar-conhecimento" class="hash-link" aria-label="Link direto para 4.7 Listar Conhecimento" title="Link direto para 4.7 Listar Conhecimento">â€‹</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Listar todos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -s http://localhost:8000/knowledge | python3 -m json.tool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Filtrar por tipo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -s &quot;http://localhost:8000/knowledge?tipo=conversa&quot; | python3 -m json.tool   # Q&amp;A e conversas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -s &quot;http://localhost:8000/knowledge?tipo=blog&quot; | python3 -m json.tool       # Artigos (alias: blog_section)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Com paginacao</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -s &quot;http://localhost:8000/knowledge?limit=10&amp;offset=0&quot; | python3 -m json.tool</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p><strong>Valores do filtro <code>tipo</code>:</strong></p>
<ul>
<li><code>tipo=blog</code> ou <code>tipo=blog_section</code> â€” retorna seÃ§Ãµes de artigos (<code>type == &quot;blog_section&quot;</code>)</li>
<li><code>tipo=conversa</code> â€” retorna Q&amp;A e conversas (<code>type != &quot;blog_section&quot;</code>)</li>
<li>sem filtro â€” retorna todos os documentos</li>
</ul>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="48-validaÃ§Ãµes-de-seguranÃ§a">4.8 ValidaÃ§Ãµes de SeguranÃ§a<a href="#48-validaÃ§Ãµes-de-seguranÃ§a" class="hash-link" aria-label="Link direto para 4.8 ValidaÃ§Ãµes de SeguranÃ§a" title="Link direto para 4.8 ValidaÃ§Ãµes de SeguranÃ§a">â€‹</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># URL para host interno bloqueado (anti-SSRF) â†’ 422</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -s -X POST http://localhost:8000/knowledge/ingest/blog \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -F &quot;url=http://169.254.169.254/metadata&quot; | python3 -m json.tool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># {&quot;detail&quot;: &quot;URL aponta para recurso interno bloqueado.&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Protocolo invÃ¡lido â†’ 422</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -s -X POST http://localhost:8000/knowledge/ingest/blog \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -F &quot;url=file:///etc/passwd&quot; | python3 -m json.tool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># {&quot;detail&quot;: &quot;Protocolo nÃ£o permitido: &#x27;file&#x27;. Use http ou https.&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Arquivo muito grande (&gt; 100KB) â†’ 422</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ConteÃºdo muito curto (&lt; 10 chars) â†’ 422</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ExtensÃ£o nÃ£o suportada (.csv, .pdf) â†’ 422</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="49-excluir-1-documento">4.9 Excluir 1 Documento<a href="#49-excluir-1-documento" class="hash-link" aria-label="Link direto para 4.9 Excluir 1 Documento" title="Link direto para 4.9 Excluir 1 Documento">â€‹</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -s -X POST http://localhost:8000/knowledge/delete \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &quot;Content-Type: application/json&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -d &#x27;{&quot;ids&quot;: &quot;SEU_DOCUMENT_ID&quot;}&#x27; | python3 -m json.tool</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="410-excluir-multiplos-documentos">4.10 Excluir Multiplos Documentos<a href="#410-excluir-multiplos-documentos" class="hash-link" aria-label="Link direto para 4.10 Excluir Multiplos Documentos" title="Link direto para 4.10 Excluir Multiplos Documentos">â€‹</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -s -X POST http://localhost:8000/knowledge/delete \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &quot;Content-Type: application/json&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -d &#x27;{&quot;ids&quot;: &quot;ID_1, ID_2, ID_3&quot;}&#x27; | python3 -m json.tool</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Resposta esperada (todos removidos):</strong></p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;status&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;success&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;message&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;3 de 3 documentos removidos&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;total_solicitados&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;total_removidos&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;resultados&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;document_id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ID_1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;tipo&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;conversa&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;status&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;success&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;document_id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ID_2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;tipo&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;blog_section&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;status&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;success&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;document_id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ID_3&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;tipo&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;conversa&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;status&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;success&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-testes-via-swagger-ui">5. Testes via Swagger UI<a href="#5-testes-via-swagger-ui" class="hash-link" aria-label="Link direto para 5. Testes via Swagger UI" title="Link direto para 5. Testes via Swagger UI">â€‹</a></h2>
<p>Acesse <strong><a href="http://localhost:8000/docs" target="_blank" rel="noopener noreferrer">http://localhost:8000/docs</a></strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="51-ingerir-blog">5.1 Ingerir Blog<a href="#51-ingerir-blog" class="hash-link" aria-label="Link direto para 5.1 Ingerir Blog" title="Link direto para 5.1 Ingerir Blog">â€‹</a></h3>
<ol>
<li>Clique em <strong>POST /knowledge/ingest/blog</strong> &gt; &quot;Try it out&quot;</li>
<li>Escolha o modo:<!-- -->
<ul>
<li><strong>URL</strong>: preencha apenas <code>url</code> com a URL do artigo</li>
<li><strong>Arquivo</strong>: no campo <code>arquivo</code>, clique em &quot;Choose File&quot; e selecione <code>.txt</code> ou <code>.md</code></li>
<li><strong>Texto</strong>: preencha apenas <code>conteudo</code> com o texto raw</li>
</ul>
</li>
<li>Clique &quot;Execute&quot;</li>
<li>Verifique: status 201, <code>&quot;status&quot;: &quot;success&quot;</code>, titulo/categoria/tags inferidos</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="52-ingerir-qa">5.2 Ingerir Q&amp;A<a href="#52-ingerir-qa" class="hash-link" aria-label="Link direto para 5.2 Ingerir Q&amp;A" title="Link direto para 5.2 Ingerir Q&amp;A">â€‹</a></h3>
<ol>
<li>Clique em <strong>POST /knowledge/ingest/qa</strong> &gt; &quot;Try it out&quot;</li>
<li>Escolha o modo:<!-- -->
<ul>
<li><strong>Arquivo</strong>: selecione arquivo <code>.txt</code> ou <code>.md</code></li>
<li><strong>Texto</strong>: preencha <code>conteudo</code> com o texto do Q&amp;A</li>
</ul>
</li>
<li>Clique &quot;Execute&quot;</li>
<li>Verifique: status 201, <code>&quot;chunks_criados&quot;: 1</code>, titulo/categoria/tags inferidos</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="53-excluir-documentos">5.3 Excluir Documentos<a href="#53-excluir-documentos" class="hash-link" aria-label="Link direto para 5.3 Excluir Documentos" title="Link direto para 5.3 Excluir Documentos">â€‹</a></h3>
<ol>
<li>Clique em <strong>POST /knowledge/delete</strong> &gt; &quot;Try it out&quot;</li>
<li>Cole no body:</li>
</ol>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;ids&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SEU_ID_AQUI&quot;</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Ou multiplos:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;ids&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ID_1, ID_2, ID_3&quot;</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li>Clique &quot;Execute&quot;</li>
<li>Verifique: <code>total_removidos</code> == numero de IDs validos</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="54-chat">5.4 Chat<a href="#54-chat" class="hash-link" aria-label="Link direto para 5.4 Chat" title="Link direto para 5.4 Chat">â€‹</a></h3>
<ol>
<li>Clique em <strong>POST /chat</strong> &gt; &quot;Try it out&quot;</li>
<li>Cole no body:</li>
</ol>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;pergunta&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;O que e o DAS do MEI?&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li>Clique &quot;Execute&quot;</li>
<li>Verifique: response contem campo <code>fontes</code> com documentos relevantes (sem campo <code>resposta</code>)</li>
</ol>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-testes-via-postman">6. Testes via Postman<a href="#6-testes-via-postman" class="hash-link" aria-label="Link direto para 6. Testes via Postman" title="Link direto para 6. Testes via Postman">â€‹</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="61-configuracao-inicial">6.1 Configuracao Inicial<a href="#61-configuracao-inicial" class="hash-link" aria-label="Link direto para 6.1 Configuracao Inicial" title="Link direto para 6.1 Configuracao Inicial">â€‹</a></h3>
<ol>
<li>Abra o Postman e crie uma nova Collection: <strong>&quot;Contabilizei RAG API&quot;</strong></li>
<li>Crie uma variavel de ambiente <code>baseUrl</code> com valor <code>http://localhost:8000</code></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="62-ingerir-blog-via-url">6.2 Ingerir Blog via URL<a href="#62-ingerir-blog-via-url" class="hash-link" aria-label="Link direto para 6.2 Ingerir Blog via URL" title="Link direto para 6.2 Ingerir Blog via URL">â€‹</a></h3>
<ul>
<li><strong>Metodo</strong>: POST</li>
<li><strong>URL</strong>: <code>{{baseUrl}}/knowledge/ingest/blog</code></li>
<li><strong>Body</strong>: selecione <code>form-data</code></li>
</ul>
<table><thead><tr><th>Key</th><th>Value</th><th>Type</th></tr></thead><tbody><tr><td>url</td><td><a href="https://contabilizei.com.br/contabilidade/o-que-e-contabilidade" target="_blank" rel="noopener noreferrer">https://contabilizei.com.br/contabilidade/o-que-e-contabilidade</a></td><td>Text</td></tr></tbody></table>
<p>Clique em <strong>Send</strong>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="63-ingerir-blog-via-arquivo">6.3 Ingerir Blog via Arquivo<a href="#63-ingerir-blog-via-arquivo" class="hash-link" aria-label="Link direto para 6.3 Ingerir Blog via Arquivo" title="Link direto para 6.3 Ingerir Blog via Arquivo">â€‹</a></h3>
<ul>
<li><strong>Metodo</strong>: POST</li>
<li><strong>URL</strong>: <code>{{baseUrl}}/knowledge/ingest/blog</code></li>
<li><strong>Body</strong>: selecione <code>form-data</code></li>
</ul>
<table><thead><tr><th>Key</th><th>Value</th><th>Type</th></tr></thead><tbody><tr><td>arquivo</td><td><em>selecione o arquivo .txt ou .md</em></td><td>File</td></tr></tbody></table>
<blockquote>
<p>No campo <code>Type</code> da linha <code>arquivo</code>, mude de <code>Text</code> para <code>File</code>, depois clique em &quot;Select Files&quot;.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="64-ingerir-blog-via-texto-raw">6.4 Ingerir Blog via Texto Raw<a href="#64-ingerir-blog-via-texto-raw" class="hash-link" aria-label="Link direto para 6.4 Ingerir Blog via Texto Raw" title="Link direto para 6.4 Ingerir Blog via Texto Raw">â€‹</a></h3>
<ul>
<li><strong>Metodo</strong>: POST</li>
<li><strong>URL</strong>: <code>{{baseUrl}}/knowledge/ingest/blog</code></li>
<li><strong>Body</strong>: selecione <code>form-data</code></li>
</ul>
<table><thead><tr><th>Key</th><th>Value</th><th>Type</th></tr></thead><tbody><tr><td>conteudo</td><td>O Simples Nacional e um regime tributario para PMEs...</td><td>Text</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="65-ingerir-qa-via-texto-raw">6.5 Ingerir Q&amp;A via Texto Raw<a href="#65-ingerir-qa-via-texto-raw" class="hash-link" aria-label="Link direto para 6.5 Ingerir Q&amp;A via Texto Raw" title="Link direto para 6.5 Ingerir Q&amp;A via Texto Raw">â€‹</a></h3>
<ul>
<li><strong>Metodo</strong>: POST</li>
<li><strong>URL</strong>: <code>{{baseUrl}}/knowledge/ingest/qa</code></li>
<li><strong>Body</strong>: selecione <code>form-data</code></li>
</ul>
<table><thead><tr><th>Key</th><th>Value</th><th>Type</th></tr></thead><tbody><tr><td>conteudo</td><td>Pergunta: O que e o DAS? Resposta: O DAS e o boleto mensal do MEI.</td><td>Text</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="66-ingerir-qa-via-arquivo">6.6 Ingerir Q&amp;A via Arquivo<a href="#66-ingerir-qa-via-arquivo" class="hash-link" aria-label="Link direto para 6.6 Ingerir Q&amp;A via Arquivo" title="Link direto para 6.6 Ingerir Q&amp;A via Arquivo">â€‹</a></h3>
<ul>
<li><strong>Metodo</strong>: POST</li>
<li><strong>URL</strong>: <code>{{baseUrl}}/knowledge/ingest/qa</code></li>
<li><strong>Body</strong>: selecione <code>form-data</code></li>
</ul>
<table><thead><tr><th>Key</th><th>Value</th><th>Type</th></tr></thead><tbody><tr><td>arquivo</td><td><em>selecione o arquivo .txt ou .md</em></td><td>File</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="67-excluir-documentos">6.7 Excluir Documentos<a href="#67-excluir-documentos" class="hash-link" aria-label="Link direto para 6.7 Excluir Documentos" title="Link direto para 6.7 Excluir Documentos">â€‹</a></h3>
<ul>
<li><strong>Metodo</strong>: POST</li>
<li><strong>URL</strong>: <code>{{baseUrl}}/knowledge/delete</code></li>
<li><strong>Body</strong>: selecione <code>raw</code> + <code>JSON</code></li>
</ul>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;ids&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;api_ingest_20260217XXXXXX_titulo&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Para multiplos:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;ids&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ID_1, ID_2, ID_3&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="68-listar-conhecimento">6.8 Listar Conhecimento<a href="#68-listar-conhecimento" class="hash-link" aria-label="Link direto para 6.8 Listar Conhecimento" title="Link direto para 6.8 Listar Conhecimento">â€‹</a></h3>
<ul>
<li><strong>Metodo</strong>: GET</li>
<li><strong>URL</strong>: <code>{{baseUrl}}/knowledge</code></li>
<li><strong>Params</strong> (opcional):</li>
</ul>
<table><thead><tr><th>Key</th><th>Value</th></tr></thead><tbody><tr><td>tipo</td><td>conversa</td></tr><tr><td>limit</td><td>10</td></tr><tr><td>offset</td><td>0</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="69-chat">6.9 Chat<a href="#69-chat" class="hash-link" aria-label="Link direto para 6.9 Chat" title="Link direto para 6.9 Chat">â€‹</a></h3>
<ul>
<li><strong>Metodo</strong>: POST</li>
<li><strong>URL</strong>: <code>{{baseUrl}}/chat</code></li>
<li><strong>Body</strong>: selecione <code>raw</code> + <code>JSON</code></li>
</ul>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;pergunta&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;O que e o DAS do MEI?&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="610-dicas-no-postman">6.10 Dicas no Postman<a href="#610-dicas-no-postman" class="hash-link" aria-label="Link direto para 6.10 Dicas no Postman" title="Link direto para 6.10 Dicas no Postman">â€‹</a></h3>
<ul>
<li><strong>Salvar IDs</strong>: no painel &quot;Tests&quot; de cada requisicao de ingestao, cole o script para salvar o ID automaticamente:</li>
</ul>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> json </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">environment</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;last_doc_id&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">documento</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Depois use <code>{{last_doc_id}}</code> nos campos de exclusao.</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="7-verificacao-direta-no-google-cloud">7. Verificacao Direta no Google Cloud<a href="#7-verificacao-direta-no-google-cloud" class="hash-link" aria-label="Link direto para 7. Verificacao Direta no Google Cloud" title="Link direto para 7. Verificacao Direta no Google Cloud">â€‹</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="71-firestore">7.1 Firestore<a href="#71-firestore" class="hash-link" aria-label="Link direto para 7.1 Firestore" title="Link direto para 7.1 Firestore">â€‹</a></h3>
<p><strong>Via Console Web:</strong></p>
<ol>
<li>Acesse <a href="https://console.cloud.google.com/firestore" target="_blank" rel="noopener noreferrer">https://console.cloud.google.com/firestore</a></li>
<li>Projeto: <code>ctbz-ia-assessoria-poc</code> | Banco: <code>rag-db-v1</code></li>
<li>Collection: <code>knowledge_base</code></li>
<li>Verifique campos: <code>type</code>, <code>source</code>, <code>base_article_id</code> (artigos), <code>metadata.categoria</code>, <code>metadata.tags</code></li>
</ol>
<p><strong>Via Python:</strong></p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> google</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cloud </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> firestore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> firestore</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Client</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">project</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;ctbz-ia-assessoria-poc&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> database</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;rag-db-v1&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Listar ingestoes via API</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">collection</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;knowledge_base&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">where</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;source&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;==&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;api_ingest_v1&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">limit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> doc </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> docs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    d </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> doc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">doc</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation builtin">id</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> | </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">d</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">get</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation string" style="color:#e3116c">&#x27;type&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> | </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">d</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">get</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation string" style="color:#e3116c">&#x27;title&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">,</span><span class="token string-interpolation interpolation string" style="color:#e3116c">&#x27;&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">[</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec">60]</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;  categoria: {d.get(&#x27;metadata&#x27;, {}).get(&#x27;categoria&#x27;)}&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;  tags: {d.get(&#x27;metadata&#x27;, {}).get(&#x27;tags&#x27;)}&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="72-vertex-ai-vector-search">7.2 Vertex AI Vector Search<a href="#72-vertex-ai-vector-search" class="hash-link" aria-label="Link direto para 7.2 Vertex AI Vector Search" title="Link direto para 7.2 Vertex AI Vector Search">â€‹</a></h3>
<p><strong>Via gcloud:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud ai indexes describe 2352965878556917760 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --region=us-central1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --project=ctbz-ia-assessoria-poc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="8-checklist-de-verificacao-final">8. Checklist de Verificacao Final<a href="#8-checklist-de-verificacao-final" class="hash-link" aria-label="Link direto para 8. Checklist de Verificacao Final" title="Link direto para 8. Checklist de Verificacao Final">â€‹</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="testes-automatizados">Testes Automatizados<a href="#testes-automatizados" class="hash-link" aria-label="Link direto para Testes Automatizados" title="Link direto para Testes Automatizados">â€‹</a></h3>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <code>./venv/bin/pytest tests/ -v</code> - Todos os testes passam</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Cobertura &gt;= 70%</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="blog--url">Blog â€” URL<a href="#blog--url" class="hash-link" aria-label="Link direto para Blog â€” URL" title="Link direto para Blog â€” URL">â€‹</a></h3>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <code>POST /knowledge/ingest/blog</code> com <code>url</code> retorna 201</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->LLM infere titulo, categoria, tags e resumo automaticamente</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <code>parents_criados &gt;= 1</code>, <code>chunks_criados &gt;= 1</code></li>
<li class="task-list-item"><input type="checkbox" disabled=""> <code>/chat</code> retorna o conteudo quando pergunta relacionada</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="blog--arquivo--texto">Blog â€” Arquivo / Texto<a href="#blog--arquivo--texto" class="hash-link" aria-label="Link direto para Blog â€” Arquivo / Texto" title="Link direto para Blog â€” Arquivo / Texto">â€‹</a></h3>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <code>POST /knowledge/ingest/blog</code> com <code>arquivo</code> (.md) retorna 201</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <code>POST /knowledge/ingest/blog</code> com <code>conteudo</code> retorna 201</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->LLM reestrutura o conteudo em markdown</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Extensao invalida (.csv) retorna 422</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="qa--arquivo--texto">Q&amp;A â€” Arquivo / Texto<a href="#qa--arquivo--texto" class="hash-link" aria-label="Link direto para Q&amp;A â€” Arquivo / Texto" title="Link direto para Q&amp;A â€” Arquivo / Texto">â€‹</a></h3>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <code>POST /knowledge/ingest/qa</code> com <code>conteudo</code> retorna 201</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <code>POST /knowledge/ingest/qa</code> com <code>arquivo</code> (.txt) retorna 201</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->LLM infere titulo, categoria e tags</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <code>chunks_criados == 1</code>, <code>vetores_criados == 1</code></li>
<li class="task-list-item"><input type="checkbox" disabled=""> <code>/chat</code> retorna o conteudo quando pergunta relacionada</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="exclusao">Exclusao<a href="#exclusao" class="hash-link" aria-label="Link direto para Exclusao" title="Link direto para Exclusao">â€‹</a></h3>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <code>POST /knowledge/delete</code> com 1 ID remove corretamente</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <code>POST /knowledge/delete</code> com N IDs (comma-separated) remove todos</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->ID inexistente retorna <code>&quot;status&quot;: &quot;partial&quot;</code> com mensagem de erro</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Exclusao de artigo remove todos os parents + vetores</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <code>/chat</code> NAO retorna conteudo excluido</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="listagem-e-chat">Listagem e Chat<a href="#listagem-e-chat" class="hash-link" aria-label="Link direto para Listagem e Chat" title="Link direto para Listagem e Chat">â€‹</a></h3>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <code>GET /knowledge</code> retorna lista paginada</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <code>GET /knowledge?tipo=conversa</code> filtra corretamente</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <code>/chat</code> retorna <code>{&quot;fontes&quot;: [...]}</code> com documentos relevantes</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <code>/chat</code> sem resultados retorna <code>{&quot;fontes&quot;: []}</code></li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="9-logs-de-observabilidade">9. Logs de Observabilidade<a href="#9-logs-de-observabilidade" class="hash-link" aria-label="Link direto para 9. Logs de Observabilidade" title="Link direto para 9. Logs de Observabilidade">â€‹</a></h2>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Blog via URL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO: Ingestao blog URL: url=&#x27;https://...&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO: Inferindo metadados de blog via LLM (gpt-4o-mini), content_len=5234</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO: Metadados blog inferidos: titulo=&#x27;...&#x27; categoria=&#x27;...&#x27; tags=[...]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO: Ingestao blog concluida: id=... titulo=&#x27;...&#x27; chunks=5 duration_ms=3210</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Q&amp;A via texto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO: Ingestao Q&amp;A texto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO: Inferindo metadados de Q&amp;A via LLM (gpt-4o-mini), content_len=342</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO: Metadados Q&amp;A inferidos: titulo=&#x27;...&#x27; categoria=&#x27;...&#x27; tags=[...]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO: Ingestao Q&amp;A concluida: id=... titulo=&#x27;...&#x27; duration_ms=1450</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Exclusao</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO: Exclusao: 2 documento(s) solicitado(s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO: Exclusao concluida: 2/2 removidos duration_ms=890</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Metricas de performance esperadas:</strong></p>
<ul>
<li>Ingestao Q&amp;A: &lt; 5.000ms (inclui chamada LLM)</li>
<li>Ingestao blog (10 secoes): &lt; 30.000ms (inclui chamada LLM)</li>
<li>Ingestao via URL: &lt; 60.000ms (inclui download + LLM)</li>
<li>Exclusao unitaria: &lt; 10.000ms</li>
<li>Exclusao em lote (10 IDs): &lt; 30.000ms</li>
<li>Chat (busca RAG): &lt; 2.000ms (sem chamada LLM)</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="10-integracao-com-o-agente-do-pedro-cloud-run">10. Integracao com o Agente do Pedro (Cloud Run)<a href="#10-integracao-com-o-agente-do-pedro-cloud-run" class="hash-link" aria-label="Link direto para 10. Integracao com o Agente do Pedro (Cloud Run)" title="Link direto para 10. Integracao com o Agente do Pedro (Cloud Run)">â€‹</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="url-base-da-api-producao">URL Base da API (producao)<a href="#url-base-da-api-producao" class="hash-link" aria-label="Link direto para URL Base da API (producao)" title="Link direto para URL Base da API (producao)">â€‹</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">https://rag-api-55837972640.us-central1.run.app</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>Nao use a URL do Swagger (<code>/docs</code>) â€” use a URL base acima.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="autenticacao-service-to-service-gcp">Autenticacao (service-to-service GCP)<a href="#autenticacao-service-to-service-gcp" class="hash-link" aria-label="Link direto para Autenticacao (service-to-service GCP)" title="Link direto para Autenticacao (service-to-service GCP)">â€‹</a></h3>
<p>O servico esta privado. O agente do Pedro (<code>agente-contabil</code>) ja tem permissao <code>roles/run.invoker</code>.
A autenticacao e feita via token OIDC da service account do Cloud Run â€” sem configuracao adicional.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> google</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">auth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">transport</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">requests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> google</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">oauth2 </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> id_token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> requests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RAG_URL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://rag-api-55837972640.us-central1.run.app&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">buscar_fontes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pergunta</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> filtro_tipo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">list</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">dict</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auth_req </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> google</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">auth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">transport</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">requests</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    token </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> id_token</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fetch_id_token</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">auth_req</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> RAG_URL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    payload </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;pergunta&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pergunta</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> filtro_tipo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        payload</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;filtro_tipo&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> filtro_tipo  </span><span class="token comment" style="color:#999988;font-style:italic"># &quot;blog&quot; ou &quot;conversa&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">RAG_URL</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">/chat&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        json</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">payload</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        headers</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;Authorization&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Bearer </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">token</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        timeout</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">raise_for_status</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;fontes&quot;</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copiar cÃ³digo para a Ã¡rea de transferÃªncia" title="Copiar" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="campos-de-cada-fonte-retornada">Campos de cada fonte retornada<a href="#campos-de-cada-fonte-retornada" class="hash-link" aria-label="Link direto para Campos de cada fonte retornada" title="Link direto para Campos de cada fonte retornada">â€‹</a></h3>
<table><thead><tr><th>Campo</th><th>Tipo</th><th>Descricao</th></tr></thead><tbody><tr><td><code>id</code></td><td>str</td><td>ID do documento no Firestore</td></tr><tr><td><code>score</code></td><td>float</td><td>Relevancia (0.50 a ~1.15)</td></tr><tr><td><code>conteudo</code></td><td>str</td><td>Texto do chunk recuperado</td></tr><tr><td><code>titulo</code></td><td>str</td><td>Titulo do artigo ou arquivo</td></tr><tr><td><code>url</code></td><td>str ou null</td><td>URL original (blogs)</td></tr><tr><td><code>tipo</code></td><td>str</td><td><code>&quot;blog&quot;</code> ou <code>&quot;conversa&quot;</code></td></tr></tbody></table></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="PÃ¡ginas de documentaÃ§Ã£o"><a class="pagination-nav__link pagination-nav__link--prev" href="/chatbot-contabilizei/docs/desenvolvimento"><div class="pagination-nav__sublabel">Anterior</div><div class="pagination-nav__label">ğŸ’» Desenvolvimento</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/chatbot-contabilizei/docs/DocumentaÃ§Ãµes de Desenvolvimento/arquitetura_ELT_blog"><div class="pagination-nav__sublabel">PrÃ³xima</div><div class="pagination-nav__label">DocumentaÃ§Ã£o TÃ©cnica: Pipeline de IngestÃ£o de Artigos (ETL Blog)</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#estatÃ­sticas-do-sistema-de-testes" class="table-of-contents__link toc-highlight">EstatÃ­sticas do Sistema de Testes</a></li><li><a href="#1-testes-automatizados" class="table-of-contents__link toc-highlight">1. Testes Automatizados</a><ul><li><a href="#11-execuÃ§Ã£o-bÃ¡sica" class="table-of-contents__link toc-highlight">1.1 ExecuÃ§Ã£o BÃ¡sica</a></li><li><a href="#12-execuÃ§Ã£o-avanÃ§ada" class="table-of-contents__link toc-highlight">1.2 ExecuÃ§Ã£o AvanÃ§ada</a></li><li><a href="#13-estrutura-de-diretÃ³rios" class="table-of-contents__link toc-highlight">1.3 Estrutura de DiretÃ³rios</a></li><li><a href="#14-mÃ³dulos-de-teste-detalhados" class="table-of-contents__link toc-highlight">1.4 MÃ³dulos de Teste Detalhados</a></li><li><a href="#15-fixtures-e-mocking" class="table-of-contents__link toc-highlight">1.5 Fixtures e Mocking</a></li><li><a href="#16-cobertura-de-cÃ³digo" class="table-of-contents__link toc-highlight">1.6 Cobertura de CÃ³digo</a></li><li><a href="#17-resoluÃ§Ã£o-de-problemas" class="table-of-contents__link toc-highlight">1.7 ResoluÃ§Ã£o de Problemas</a></li><li><a href="#18-boas-prÃ¡ticas" class="table-of-contents__link toc-highlight">1.8 Boas PrÃ¡ticas</a></li></ul></li><li><a href="#2-iniciar-a-api-localmente" class="table-of-contents__link toc-highlight">2. Iniciar a API Localmente</a></li><li><a href="#3-mapa-de-endpoints" class="table-of-contents__link toc-highlight">3. Mapa de Endpoints</a><ul><li><a href="#fluxo-de-ingestao" class="table-of-contents__link toc-highlight">Fluxo de ingestao</a></li></ul></li><li><a href="#4-testes-via-terminal-curl" class="table-of-contents__link toc-highlight">4. Testes via Terminal (curl)</a><ul><li><a href="#41-ingerir-blog-via-url" class="table-of-contents__link toc-highlight">4.1 Ingerir Blog via URL</a></li><li><a href="#42-ingerir-blog-via-arquivo" class="table-of-contents__link toc-highlight">4.2 Ingerir Blog via Arquivo</a></li><li><a href="#43-ingerir-blog-via-texto-raw" class="table-of-contents__link toc-highlight">4.3 Ingerir Blog via Texto Raw</a></li><li><a href="#44-ingerir-qa-via-texto-raw" class="table-of-contents__link toc-highlight">4.4 Ingerir Q&amp;A via Texto Raw</a></li><li><a href="#45-ingerir-qa-via-upload-de-arquivo" class="table-of-contents__link toc-highlight">4.5 Ingerir Q&amp;A via Upload de Arquivo</a></li><li><a href="#46-verificar-no-chat" class="table-of-contents__link toc-highlight">4.6 Verificar no /chat</a></li><li><a href="#47-listar-conhecimento" class="table-of-contents__link toc-highlight">4.7 Listar Conhecimento</a></li><li><a href="#48-validaÃ§Ãµes-de-seguranÃ§a" class="table-of-contents__link toc-highlight">4.8 ValidaÃ§Ãµes de SeguranÃ§a</a></li><li><a href="#49-excluir-1-documento" class="table-of-contents__link toc-highlight">4.9 Excluir 1 Documento</a></li><li><a href="#410-excluir-multiplos-documentos" class="table-of-contents__link toc-highlight">4.10 Excluir Multiplos Documentos</a></li></ul></li><li><a href="#5-testes-via-swagger-ui" class="table-of-contents__link toc-highlight">5. Testes via Swagger UI</a><ul><li><a href="#51-ingerir-blog" class="table-of-contents__link toc-highlight">5.1 Ingerir Blog</a></li><li><a href="#52-ingerir-qa" class="table-of-contents__link toc-highlight">5.2 Ingerir Q&amp;A</a></li><li><a href="#53-excluir-documentos" class="table-of-contents__link toc-highlight">5.3 Excluir Documentos</a></li><li><a href="#54-chat" class="table-of-contents__link toc-highlight">5.4 Chat</a></li></ul></li><li><a href="#6-testes-via-postman" class="table-of-contents__link toc-highlight">6. Testes via Postman</a><ul><li><a href="#61-configuracao-inicial" class="table-of-contents__link toc-highlight">6.1 Configuracao Inicial</a></li><li><a href="#62-ingerir-blog-via-url" class="table-of-contents__link toc-highlight">6.2 Ingerir Blog via URL</a></li><li><a href="#63-ingerir-blog-via-arquivo" class="table-of-contents__link toc-highlight">6.3 Ingerir Blog via Arquivo</a></li><li><a href="#64-ingerir-blog-via-texto-raw" class="table-of-contents__link toc-highlight">6.4 Ingerir Blog via Texto Raw</a></li><li><a href="#65-ingerir-qa-via-texto-raw" class="table-of-contents__link toc-highlight">6.5 Ingerir Q&amp;A via Texto Raw</a></li><li><a href="#66-ingerir-qa-via-arquivo" class="table-of-contents__link toc-highlight">6.6 Ingerir Q&amp;A via Arquivo</a></li><li><a href="#67-excluir-documentos" class="table-of-contents__link toc-highlight">6.7 Excluir Documentos</a></li><li><a href="#68-listar-conhecimento" class="table-of-contents__link toc-highlight">6.8 Listar Conhecimento</a></li><li><a href="#69-chat" class="table-of-contents__link toc-highlight">6.9 Chat</a></li><li><a href="#610-dicas-no-postman" class="table-of-contents__link toc-highlight">6.10 Dicas no Postman</a></li></ul></li><li><a href="#7-verificacao-direta-no-google-cloud" class="table-of-contents__link toc-highlight">7. Verificacao Direta no Google Cloud</a><ul><li><a href="#71-firestore" class="table-of-contents__link toc-highlight">7.1 Firestore</a></li><li><a href="#72-vertex-ai-vector-search" class="table-of-contents__link toc-highlight">7.2 Vertex AI Vector Search</a></li></ul></li><li><a href="#8-checklist-de-verificacao-final" class="table-of-contents__link toc-highlight">8. Checklist de Verificacao Final</a><ul><li><a href="#testes-automatizados" class="table-of-contents__link toc-highlight">Testes Automatizados</a></li><li><a href="#blog--url" class="table-of-contents__link toc-highlight">Blog â€” URL</a></li><li><a href="#blog--arquivo--texto" class="table-of-contents__link toc-highlight">Blog â€” Arquivo / Texto</a></li><li><a href="#qa--arquivo--texto" class="table-of-contents__link toc-highlight">Q&amp;A â€” Arquivo / Texto</a></li><li><a href="#exclusao" class="table-of-contents__link toc-highlight">Exclusao</a></li><li><a href="#listagem-e-chat" class="table-of-contents__link toc-highlight">Listagem e Chat</a></li></ul></li><li><a href="#9-logs-de-observabilidade" class="table-of-contents__link toc-highlight">9. Logs de Observabilidade</a></li><li><a href="#10-integracao-com-o-agente-do-pedro-cloud-run" class="table-of-contents__link toc-highlight">10. Integracao com o Agente do Pedro (Cloud Run)</a><ul><li><a href="#url-base-da-api-producao" class="table-of-contents__link toc-highlight">URL Base da API (producao)</a></li><li><a href="#autenticacao-service-to-service-gcp" class="table-of-contents__link toc-highlight">Autenticacao (service-to-service GCP)</a></li><li><a href="#campos-de-cada-fonte-retornada" class="table-of-contents__link toc-highlight">Campos de cada fonte retornada</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2026 Consultor ContÃ¡bil de IA, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>