"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[408],{5914:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>d,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"Documenta\xe7\xf5es de Desenvolvimento/Guia_teste_pipeline_documentos","title":"Guia de Verifica\xe7\xe3o \u2014 API de Conhecimento RAG + Sistema de Testes","description":"Este documento consolida o guia operacional da API (endpoints, curl, Swagger, Postman, GCP) e o","source":"@site/docs/Documenta\xe7\xf5es de Desenvolvimento/Guia_teste_pipeline_documentos.md","sourceDirName":"Documenta\xe7\xf5es de Desenvolvimento","slug":"/Documenta\xe7\xf5es de Desenvolvimento/Guia_teste_pipeline_documentos","permalink":"/chatbot-contabilizei/docs/Documenta\xe7\xf5es de Desenvolvimento/Guia_teste_pipeline_documentos","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\ud83d\udcbb Desenvolvimento","permalink":"/chatbot-contabilizei/docs/desenvolvimento"},"next":{"title":"Documenta\xe7\xe3o T\xe9cnica: Pipeline de Ingest\xe3o de Artigos (ETL Blog)","permalink":"/chatbot-contabilizei/docs/Documenta\xe7\xf5es de Desenvolvimento/arquitetura_ELT_blog"}}');var t=n(4848),r=n(8453);const d={},o="Guia de Verifica\xe7\xe3o \u2014 API de Conhecimento RAG + Sistema de Testes",c={},l=[{value:"Estat\xedsticas do Sistema de Testes",id:"estat\xedsticas-do-sistema-de-testes",level:2},{value:"1. Testes Automatizados",id:"1-testes-automatizados",level:2},{value:"1.1 Execu\xe7\xe3o B\xe1sica",id:"11-execu\xe7\xe3o-b\xe1sica",level:3},{value:"1.2 Execu\xe7\xe3o Avan\xe7ada",id:"12-execu\xe7\xe3o-avan\xe7ada",level:3},{value:"1.3 Estrutura de Diret\xf3rios",id:"13-estrutura-de-diret\xf3rios",level:3},{value:"pytest.ini",id:"pytestini",level:4},{value:"1.4 M\xf3dulos de Teste Detalhados",id:"14-m\xf3dulos-de-teste-detalhados",level:3},{value:"test_chunking.py",id:"test_chunkingpy",level:4},{value:"test_retrieval_logic.py",id:"test_retrieval_logicpy",level:4},{value:"test_embeddings.py",id:"test_embeddingspy",level:4},{value:"test_llm_metadata.py",id:"test_llm_metadatapy",level:4},{value:"test_url_fetcher.py",id:"test_url_fetcherpy",level:4},{value:"test_vertex_service.py",id:"test_vertex_servicepy",level:4},{value:"test_firestore_service.py",id:"test_firestore_servicepy",level:4},{value:"test_api_contract.py",id:"test_api_contractpy",level:4},{value:"test_e2e_knowledge_lifecycle.py",id:"test_e2e_knowledge_lifecyclepy",level:4},{value:"1.5 Fixtures e Mocking",id:"15-fixtures-e-mocking",level:3},{value:"Fixtures de Mocks",id:"fixtures-de-mocks",level:4},{value:"Fixtures de Dados",id:"fixtures-de-dados",level:4},{value:"Padr\xe3o de Mocking com <code>@patch</code>",id:"padr\xe3o-de-mocking-com-patch",level:4},{value:"Padr\xe3o AAA",id:"padr\xe3o-aaa",level:4},{value:"1.6 Cobertura de C\xf3digo",id:"16-cobertura-de-c\xf3digo",level:3},{value:"1.7 Resolu\xe7\xe3o de Problemas",id:"17-resolu\xe7\xe3o-de-problemas",level:3},{value:"1.8 Boas Pr\xe1ticas",id:"18-boas-pr\xe1ticas",level:3},{value:"2. Iniciar a API Localmente",id:"2-iniciar-a-api-localmente",level:2},{value:"3. Mapa de Endpoints",id:"3-mapa-de-endpoints",level:2},{value:"Fluxo de ingestao",id:"fluxo-de-ingestao",level:3},{value:"4. Testes via Terminal (curl)",id:"4-testes-via-terminal-curl",level:2},{value:"4.1 Ingerir Blog via URL",id:"41-ingerir-blog-via-url",level:3},{value:"4.2 Ingerir Blog via Arquivo",id:"42-ingerir-blog-via-arquivo",level:3},{value:"4.3 Ingerir Blog via Texto Raw",id:"43-ingerir-blog-via-texto-raw",level:3},{value:"4.4 Ingerir Q&amp;A via Texto Raw",id:"44-ingerir-qa-via-texto-raw",level:3},{value:"4.5 Ingerir Q&amp;A via Upload de Arquivo",id:"45-ingerir-qa-via-upload-de-arquivo",level:3},{value:"4.6 Verificar no /chat",id:"46-verificar-no-chat",level:3},{value:"4.7 Listar Conhecimento",id:"47-listar-conhecimento",level:3},{value:"4.8 Valida\xe7\xf5es de Seguran\xe7a",id:"48-valida\xe7\xf5es-de-seguran\xe7a",level:3},{value:"4.9 Excluir 1 Documento",id:"49-excluir-1-documento",level:3},{value:"4.10 Excluir Multiplos Documentos",id:"410-excluir-multiplos-documentos",level:3},{value:"5. Testes via Swagger UI",id:"5-testes-via-swagger-ui",level:2},{value:"5.1 Ingerir Blog",id:"51-ingerir-blog",level:3},{value:"5.2 Ingerir Q&amp;A",id:"52-ingerir-qa",level:3},{value:"5.3 Excluir Documentos",id:"53-excluir-documentos",level:3},{value:"5.4 Chat",id:"54-chat",level:3},{value:"6. Testes via Postman",id:"6-testes-via-postman",level:2},{value:"6.1 Configuracao Inicial",id:"61-configuracao-inicial",level:3},{value:"6.2 Ingerir Blog via URL",id:"62-ingerir-blog-via-url",level:3},{value:"6.3 Ingerir Blog via Arquivo",id:"63-ingerir-blog-via-arquivo",level:3},{value:"6.4 Ingerir Blog via Texto Raw",id:"64-ingerir-blog-via-texto-raw",level:3},{value:"6.5 Ingerir Q&amp;A via Texto Raw",id:"65-ingerir-qa-via-texto-raw",level:3},{value:"6.6 Ingerir Q&amp;A via Arquivo",id:"66-ingerir-qa-via-arquivo",level:3},{value:"6.7 Excluir Documentos",id:"67-excluir-documentos",level:3},{value:"6.8 Listar Conhecimento",id:"68-listar-conhecimento",level:3},{value:"6.9 Chat",id:"69-chat",level:3},{value:"6.10 Dicas no Postman",id:"610-dicas-no-postman",level:3},{value:"7. Verificacao Direta no Google Cloud",id:"7-verificacao-direta-no-google-cloud",level:2},{value:"7.1 Firestore",id:"71-firestore",level:3},{value:"7.2 Vertex AI Vector Search",id:"72-vertex-ai-vector-search",level:3},{value:"8. Checklist de Verificacao Final",id:"8-checklist-de-verificacao-final",level:2},{value:"Testes Automatizados",id:"testes-automatizados",level:3},{value:"Blog \u2014 URL",id:"blog--url",level:3},{value:"Blog \u2014 Arquivo / Texto",id:"blog--arquivo--texto",level:3},{value:"Q&amp;A \u2014 Arquivo / Texto",id:"qa--arquivo--texto",level:3},{value:"Exclusao",id:"exclusao",level:3},{value:"Listagem e Chat",id:"listagem-e-chat",level:3},{value:"9. Logs de Observabilidade",id:"9-logs-de-observabilidade",level:2},{value:"10. Integracao com o Agente do Pedro (Cloud Run)",id:"10-integracao-com-o-agente-do-pedro-cloud-run",level:2},{value:"URL Base da API (producao)",id:"url-base-da-api-producao",level:3},{value:"Autenticacao (service-to-service GCP)",id:"autenticacao-service-to-service-gcp",level:3},{value:"Campos de cada fonte retornada",id:"campos-de-cada-fonte-retornada",level:3}];function a(e){const s={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"guia-de-verifica\xe7\xe3o--api-de-conhecimento-rag--sistema-de-testes",children:"Guia de Verifica\xe7\xe3o \u2014 API de Conhecimento RAG + Sistema de Testes"})}),"\n",(0,t.jsx)(s.p,{children:"Este documento consolida o guia operacional da API (endpoints, curl, Swagger, Postman, GCP) e o\nmanual t\xe9cnico do sistema de testes automatizados em um \xfanico ponto de refer\xeancia."}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"estat\xedsticas-do-sistema-de-testes",children:"Estat\xedsticas do Sistema de Testes"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"M\xe9trica"}),(0,t.jsx)(s.th,{children:"Valor Atual"}),(0,t.jsx)(s.th,{children:"Target"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Total de Testes"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"96"})}),(0,t.jsx)(s.td,{children:"\u2265 95"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Taxa de Sucesso"}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.strong,{children:"100%"})," (96/96)"]}),(0,t.jsx)(s.td,{children:"100%"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Cobertura de C\xf3digo"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"88.53%"})}),(0,t.jsx)(s.td,{children:"\u2265 70%"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Tempo de Execu\xe7\xe3o"}),(0,t.jsx)(s.td,{children:"~10s"}),(0,t.jsx)(s.td,{children:"< 30s"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Testes Unit\xe1rios"}),(0,t.jsx)(s.td,{children:"~76"}),(0,t.jsx)(s.td,{children:"\u2014"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Testes de Integra\xe7\xe3o"}),(0,t.jsx)(s.td,{children:"~20"}),(0,t.jsx)(s.td,{children:"\u2014"})]})]})]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Tecnologias de Teste:"})}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Framework: pytest 7.4.3+"}),"\n",(0,t.jsx)(s.li,{children:"Cobertura: coverage.py"}),"\n",(0,t.jsx)(s.li,{children:"Async: pytest-asyncio"}),"\n",(0,t.jsxs)(s.li,{children:["Threshold m\xednimo: 70% (configurado em ",(0,t.jsx)(s.code,{children:"pytest.ini"}),")"]}),"\n"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"1-testes-automatizados",children:"1. Testes Automatizados"}),"\n",(0,t.jsx)(s.h3,{id:"11-execu\xe7\xe3o-b\xe1sica",children:"1.1 Execu\xe7\xe3o B\xe1sica"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"cd arquitetura_RAG\n\n# Todos os testes\n./venv/bin/pytest tests/ -v\n\n# Por tipo\n./venv/bin/pytest -m unit -v\n./venv/bin/pytest -m integration -v\n./venv/bin/pytest -m critical -v\n\n# End-to-End\n./venv/bin/pytest tests/integration/test_e2e_knowledge_lifecycle.py -v\n\n# Sem cobertura (mais r\xe1pido)\n./venv/bin/pytest tests/ -v --no-cov\n"})}),"\n",(0,t.jsx)(s.h3,{id:"12-execu\xe7\xe3o-avan\xe7ada",children:"1.2 Execu\xe7\xe3o Avan\xe7ada"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"# Arquivo espec\xedfico\n./venv/bin/pytest tests/unit/test_chunking.py -v\n\n# Teste espec\xedfico\n./venv/bin/pytest tests/unit/test_chunking.py::TestSafeRecursiveSplit::test_table_not_broken -v\n\n# Modo silencioso\n./venv/bin/pytest tests/ -q\n\n# Parar no primeiro erro\n./venv/bin/pytest tests/ -x\n\n# Reexecutar apenas testes que falharam\n./venv/bin/pytest --lf\n\n# Com cobertura e relat\xf3rio HTML\n./venv/bin/pytest tests/ --cov --cov-report=html\nxdg-open htmlcov/index.html  # Linux\n\n# Relat\xf3rio de cobertura no terminal\n./venv/bin/pytest tests/ --cov --cov-report=term-missing\n"})}),"\n",(0,t.jsx)(s.h3,{id:"13-estrutura-de-diret\xf3rios",children:"1.3 Estrutura de Diret\xf3rios"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"arquitetura_RAG/\n\u251c\u2500\u2500 tests/                                    # Diret\xf3rio principal de testes\n\u2502   \u251c\u2500\u2500 conftest.py                           # Fixtures compartilhadas\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u251c\u2500\u2500 unit/                                 # Testes unit\xe1rios\n\u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u251c\u2500\u2500 test_chunking.py                  # Chunking de documentos\n\u2502   \u2502   \u251c\u2500\u2500 test_retrieval_logic.py           # L\xf3gica de busca RAG\n\u2502   \u2502   \u251c\u2500\u2500 test_embeddings.py                # Gera\xe7\xe3o de embeddings\n\u2502   \u2502   \u251c\u2500\u2500 test_llm_metadata.py              # Infer\xeancia de metadados via LLM\n\u2502   \u2502   \u251c\u2500\u2500 test_url_fetcher.py               # Fetch e parse de URLs\n\u2502   \u2502   \u251c\u2500\u2500 test_vertex_service.py            # Upsert/search/delete no Vertex AI\n\u2502   \u2502   \u2514\u2500\u2500 test_firestore_service.py         # CRUD no Firestore\n\u2502   \u2514\u2500\u2500 integration/                          # Testes de integra\xe7\xe3o\n\u2502       \u251c\u2500\u2500 __init__.py\n\u2502       \u251c\u2500\u2500 test_api_contract.py              # Contrato dos endpoints\n\u2502       \u2514\u2500\u2500 test_e2e_knowledge_lifecycle.py   # Ciclo completo: ingest\u2192chat\u2192delete\n\u251c\u2500\u2500 pytest.ini                                # Configura\xe7\xe3o do pytest\n\u251c\u2500\u2500 requirements-dev.txt                      # Depend\xeancias de teste\n\u251c\u2500\u2500 htmlcov/                                  # Relat\xf3rios de cobertura HTML (gerado)\n\u2514\u2500\u2500 .coverage                                 # Banco de dados de cobertura (gerado)\n"})}),"\n",(0,t.jsx)(s.h4,{id:"pytestini",children:"pytest.ini"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ini",children:"[pytest]\ntestpaths = tests\npython_files = test_*.py\npython_classes = Test*\npython_functions = test_*\n\naddopts =\n    --verbose\n    --strict-markers\n    --color=yes\n    --tb=short\n    --cov=app_rag\n    --cov-fail-under=70\n\nmarkers =\n    unit: Testes unit\xe1rios\n    integration: Testes de integra\xe7\xe3o\n    critical: Testes de funcionalidades cr\xedticas\n"})}),"\n",(0,t.jsx)(s.h3,{id:"14-m\xf3dulos-de-teste-detalhados",children:"1.4 M\xf3dulos de Teste Detalhados"}),"\n",(0,t.jsx)(s.h4,{id:"test_chunkingpy",children:"test_chunking.py"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Arquivo testado:"})," ",(0,t.jsx)(s.code,{children:"app_rag/services/chunking.py"})]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Fun\xe7\xf5es testadas:"})," ",(0,t.jsx)(s.code,{children:"smart_parent_split()"}),", ",(0,t.jsx)(s.code,{children:"smart_recursive_split()"})]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Justificativa:"})," Tabelas tribut\xe1rias n\xe3o podem ser quebradas no meio \u2014 isso levaria a informa\xe7\xf5es incorretas no RAG."]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Teste"}),(0,t.jsx)(s.th,{children:"Descri\xe7\xe3o"}),(0,t.jsx)(s.th,{children:"Marcador"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"test_parent_split_respects_limit"})}),(0,t.jsx)(s.td,{children:"Nenhum parent excede 6000 chars"}),(0,t.jsx)(s.td,{children:"unit"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"test_parent_split_prefers_paragraph_breaks"})}),(0,t.jsx)(s.td,{children:"Quebras preferem par\xe1grafos, n\xe3o meio de frases"}),(0,t.jsx)(s.td,{children:"unit"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"test_chunks_respect_size_limit"})}),(0,t.jsx)(s.td,{children:"Chunks n\xe3o excedem 800 chars"}),(0,t.jsx)(s.td,{children:"unit"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"test_chunks_have_overlap"})}),(0,t.jsx)(s.td,{children:"Overlap de 200 chars preserva contexto"}),(0,t.jsx)(s.td,{children:"unit"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"test_table_not_broken"})}),(0,t.jsx)(s.td,{children:"Tabelas Markdown permanecem \xedntegras"}),(0,t.jsxs)(s.td,{children:["unit, ",(0,t.jsx)(s.strong,{children:"critical"})]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"test_empty_text_handling"})}),(0,t.jsx)(s.td,{children:"Strings vazias n\xe3o geram exce\xe7\xf5es"}),(0,t.jsx)(s.td,{children:"unit"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"test_very_short_text_not_chunked"})}),(0,t.jsx)(s.td,{children:"Textos < chunk_size n\xe3o s\xe3o divididos"}),(0,t.jsx)(s.td,{children:"unit"})]})]})]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"pytest tests/unit/test_chunking.py -v\npytest tests/unit/test_chunking.py::TestSafeRecursiveSplit::test_table_not_broken -v\n"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h4,{id:"test_retrieval_logicpy",children:"test_retrieval_logic.py"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Arquivo testado:"})," ",(0,t.jsx)(s.code,{children:"app_rag/main.py"})]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Fun\xe7\xe3o testada:"})," ",(0,t.jsx)(s.code,{children:"retrieve_context(query_vector, k=5, filtro_tipo=None)"})]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Justificativa:"})," N\xfacleo do RAG. Implementa busca vetorial, boost para blogs, threshold e deduplica\xe7\xe3o."]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Teste"}),(0,t.jsx)(s.th,{children:"Descri\xe7\xe3o"}),(0,t.jsx)(s.th,{children:"Marcador"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"test_blog_boost_applied_correctly"})}),(0,t.jsx)(s.td,{children:"Blogs recebem boost de 15% (0.70 \u2192 0.805)"}),(0,t.jsxs)(s.td,{children:["unit, ",(0,t.jsx)(s.strong,{children:"critical"})]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"test_threshold_minimum_score"})}),(0,t.jsx)(s.td,{children:"Documentos com score < 0.50 s\xe3o descartados"}),(0,t.jsxs)(s.td,{children:["unit, ",(0,t.jsx)(s.strong,{children:"critical"})]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"test_parent_deduplication"})}),(0,t.jsx)(s.td,{children:"M\xfaltiplos chunks do mesmo parent: mant\xe9m s\xf3 o de maior score"}),(0,t.jsxs)(s.td,{children:["unit, ",(0,t.jsx)(s.strong,{children:"critical"})]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"test_filter_by_type_blog"})}),(0,t.jsx)(s.td,{children:'Filtro por tipo "blog" funciona'}),(0,t.jsx)(s.td,{children:"unit"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"test_filter_by_type_conversa"})}),(0,t.jsx)(s.td,{children:'Filtro por tipo "conversa" funciona'}),(0,t.jsx)(s.td,{children:"unit"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"test_empty_results_from_vertex"})}),(0,t.jsx)(s.td,{children:"Resultados vazios sem exce\xe7\xf5es"}),(0,t.jsx)(s.td,{children:"unit"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"test_top_k_limit_respected"})}),(0,t.jsx)(s.td,{children:"Par\xe2metro k limita n\xfamero de documentos"}),(0,t.jsx)(s.td,{children:"unit"})]})]})]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"pytest tests/unit/test_retrieval_logic.py -v\n"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h4,{id:"test_embeddingspy",children:"test_embeddings.py"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Arquivo testado:"})," ",(0,t.jsx)(s.code,{children:"app_rag/services/embedding.py"})]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Fun\xe7\xf5es testadas:"})," ",(0,t.jsx)(s.code,{children:"get_embedding()"}),", ",(0,t.jsx)(s.code,{children:"get_embeddings_batch()"})]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Teste"}),(0,t.jsx)(s.th,{children:"Descri\xe7\xe3o"}),(0,t.jsx)(s.th,{children:"Marcador"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"test_newlines_replaced_by_space"})}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"\\n"})," substitu\xeddos antes de envio \xe0 API"]}),(0,t.jsx)(s.td,{children:"unit"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"test_returns_1536_dimensions"})}),(0,t.jsx)(s.td,{children:"Embedding retorna vetor de 1536 dimens\xf5es"}),(0,t.jsx)(s.td,{children:"unit"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"test_empty_text_handling"})}),(0,t.jsx)(s.td,{children:"Texto vazio \xe9 enviado ao cliente e retorna embedding normalmente (contrato determin\xedstico)"}),(0,t.jsx)(s.td,{children:"unit"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"test_batch_returns_correct_count"})}),(0,t.jsx)(s.td,{children:"Batch retorna 1 embedding por texto"}),(0,t.jsx)(s.td,{children:"unit"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"test_batch_replaces_newlines"})}),(0,t.jsxs)(s.td,{children:["Batch substitui ",(0,t.jsx)(s.code,{children:"\\n"})," em todos os textos"]}),(0,t.jsx)(s.td,{children:"unit"})]})]})]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"pytest tests/unit/test_embeddings.py -v\n"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h4,{id:"test_llm_metadatapy",children:"test_llm_metadata.py"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Arquivo testado:"})," ",(0,t.jsx)(s.code,{children:"app_rag/services/llm_metadata.py"})]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Fun\xe7\xf5es testadas:"})," ",(0,t.jsx)(s.code,{children:"infer_blog_metadata()"}),", ",(0,t.jsx)(s.code,{children:"infer_qa_metadata()"})]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Justificativa:"})," Valida que a infer\xeancia de metadados via LLM (gpt-4o-mini) retorna ",(0,t.jsx)(s.code,{children:"BlogMetadata"})," e ",(0,t.jsx)(s.code,{children:"QAMetadata"})," com os campos corretos, mockando o cliente OpenAI."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"pytest tests/unit/test_llm_metadata.py -v\n"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h4,{id:"test_url_fetcherpy",children:"test_url_fetcher.py"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Arquivo testado:"})," ",(0,t.jsx)(s.code,{children:"app_rag/services/url_fetcher.py"})]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Fun\xe7\xe3o testada:"})," ",(0,t.jsx)(s.code,{children:"fetch_url_content(url)"})," \u2192 retorna ",(0,t.jsx)(s.code,{children:"UrlContent(text, title)"})]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Justificativa:"})," Valida fetch de URL, convers\xe3o HTML\u2192Markdown, prote\xe7\xe3o anti-SSRF (",(0,t.jsx)(s.code,{children:"_validate_url"})," bloqueia hosts internos e protocolos n\xe3o-HTTP) e tratamento de URLs inv\xe1lidas ou indispon\xedveis."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"pytest tests/unit/test_url_fetcher.py -v\n"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h4,{id:"test_vertex_servicepy",children:"test_vertex_service.py"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Arquivo testado:"})," ",(0,t.jsx)(s.code,{children:"app_rag/services/vertex_service.py"})]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Fun\xe7\xf5es testadas:"})," ",(0,t.jsx)(s.code,{children:"upsert_datapoints()"}),", ",(0,t.jsx)(s.code,{children:"remove_datapoints()"}),", ",(0,t.jsx)(s.code,{children:"search_neighbors()"})]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Justificativa:"})," Valida opera\xe7\xf5es no Vertex AI Vector Search mockando o endpoint, verificando formato de datapoints e tratamento de erros."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"pytest tests/unit/test_vertex_service.py -v\n"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h4,{id:"test_firestore_servicepy",children:"test_firestore_service.py"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Arquivo testado:"})," ",(0,t.jsx)(s.code,{children:"app_rag/services/firestore_service.py"})]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Fun\xe7\xf5es testadas:"})," ",(0,t.jsx)(s.code,{children:"create_document()"}),", ",(0,t.jsx)(s.code,{children:"get_document()"}),", ",(0,t.jsx)(s.code,{children:"delete_document()"}),", ",(0,t.jsx)(s.code,{children:"find_documents_by_base_article_id()"}),", ",(0,t.jsx)(s.code,{children:"list_documents()"})]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Justificativa:"})," Valida CRUD no Firestore (",(0,t.jsx)(s.code,{children:"rag-db-v1"}),", collection ",(0,t.jsx)(s.code,{children:"knowledge_base"}),") mockando o cliente. Inclui testes de mapeamento dos filtros de tipo:"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"tipo=blog"})," \u2192 ",(0,t.jsx)(s.code,{children:'WHERE type == "blog_section"'})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"tipo=conversa"})," \u2192 ",(0,t.jsx)(s.code,{children:'WHERE type != "blog_section"'})," (inclui todos os n\xe3o-blog)"]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"pytest tests/unit/test_firestore_service.py -v\n"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h4,{id:"test_api_contractpy",children:"test_api_contract.py"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Arquivo testado:"})," ",(0,t.jsx)(s.code,{children:"app_rag/main.py"})]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Endpoints testados:"})," ",(0,t.jsx)(s.code,{children:"/knowledge/ingest/blog"}),", ",(0,t.jsx)(s.code,{children:"/knowledge/ingest/qa"}),", ",(0,t.jsx)(s.code,{children:"/knowledge/delete"}),", ",(0,t.jsx)(s.code,{children:"GET /knowledge"}),", ",(0,t.jsx)(s.code,{children:"/chat"})]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Justificativa:"})," Valida o contrato completo da API \u2014 campos de request/response, status codes e comportamento dos endpoints."]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Teste"}),(0,t.jsx)(s.th,{children:"Descri\xe7\xe3o"}),(0,t.jsx)(s.th,{children:"Marcador"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"test_chat_endpoint_valid_request"})}),(0,t.jsxs)(s.td,{children:["Request v\xe1lido retorna ",(0,t.jsx)(s.code,{children:"fontes"})]}),(0,t.jsxs)(s.td,{children:["integration, ",(0,t.jsx)(s.strong,{children:"critical"})]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"test_response_structure"})}),(0,t.jsxs)(s.td,{children:["Response tem campo ",(0,t.jsx)(s.code,{children:"fontes"}),", sem campo ",(0,t.jsx)(s.code,{children:"resposta"})]}),(0,t.jsx)(s.td,{children:"integration"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"test_fontes_structure"})}),(0,t.jsx)(s.td,{children:"Cada fonte tem id, score, conteudo, titulo, tipo"}),(0,t.jsx)(s.td,{children:"integration"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"test_filtro_tipo_blog_applied"})}),(0,t.jsx)(s.td,{children:'Filtro por tipo "blog" \xe9 aplicado'}),(0,t.jsx)(s.td,{children:"integration"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"test_no_results_returns_empty_fontes"})}),(0,t.jsxs)(s.td,{children:["Sem resultados retorna ",(0,t.jsx)(s.code,{children:'{"fontes": []}'})]}),(0,t.jsx)(s.td,{children:"integration"})]})]})]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"pytest tests/integration/test_api_contract.py -v\n"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h4,{id:"test_e2e_knowledge_lifecyclepy",children:"test_e2e_knowledge_lifecycle.py"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Arquivo testado:"})," ",(0,t.jsx)(s.code,{children:"app_rag/main.py"})," (fluxo completo)"]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Justificativa:"})," Testa o ciclo completo (ingest\xe3o \u2192 busca \u2192 exclus\xe3o \u2192 verifica\xe7\xe3o de remo\xe7\xe3o), mockando apenas as APIs externas."]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Classe"}),(0,t.jsx)(s.th,{children:"Teste"}),(0,t.jsx)(s.th,{children:"Descri\xe7\xe3o"}),(0,t.jsx)(s.th,{children:"Marcador"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"TestKnowledgeLifecycleE2E"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"test_qa_ingest_then_chat_then_delete"})}),(0,t.jsx)(s.td,{children:"Ciclo completo Q&A"}),(0,t.jsxs)(s.td,{children:["integration, ",(0,t.jsx)(s.strong,{children:"critical"})]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"TestKnowledgeLifecycleE2E"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"test_artigo_ingest_then_chat_then_delete"})}),(0,t.jsx)(s.td,{children:"Ciclo completo Artigo"}),(0,t.jsxs)(s.td,{children:["integration, ",(0,t.jsx)(s.strong,{children:"critical"})]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"TestPerformanceMetrics"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"test_qa_ingest_under_5_seconds"})}),(0,t.jsx)(s.td,{children:"Q&A ingest\xe3o < 5s"}),(0,t.jsx)(s.td,{children:"integration"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"TestPerformanceMetrics"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"test_artigo_ingest_under_30_seconds"})}),(0,t.jsx)(s.td,{children:"Artigo ingest\xe3o < 30s"}),(0,t.jsx)(s.td,{children:"integration"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"TestChatRegression"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"test_chat_with_blog_result"})}),(0,t.jsx)(s.td,{children:"Chat com resultado blog"}),(0,t.jsx)(s.td,{children:"integration"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"TestChatRegression"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"test_chat_with_conversa_result"})}),(0,t.jsx)(s.td,{children:"Chat com resultado conversa"}),(0,t.jsx)(s.td,{children:"integration"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"TestChatRegression"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"test_chat_no_results_graceful"})}),(0,t.jsx)(s.td,{children:"Chat sem resultados"}),(0,t.jsx)(s.td,{children:"integration"})]})]})]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"pytest tests/integration/test_e2e_knowledge_lifecycle.py -v\n"})}),"\n",(0,t.jsx)(s.h3,{id:"15-fixtures-e-mocking",children:"1.5 Fixtures e Mocking"}),"\n",(0,t.jsxs)(s.p,{children:["Fixtures definidas em ",(0,t.jsx)(s.code,{children:"tests/conftest.py"})," e injetadas automaticamente pelo pytest."]}),"\n",(0,t.jsx)(s.h4,{id:"fixtures-de-mocks",children:"Fixtures de Mocks"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Fixture"}),(0,t.jsx)(s.th,{children:"O que simula"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"mock_firestore_client"})}),(0,t.jsx)(s.td,{children:"Cliente Firestore (sem acesso real ao banco)"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"mock_vertex_endpoint"})}),(0,t.jsx)(s.td,{children:"Vertex AI Endpoint (upsert, search, remove)"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"mock_openai_client"})}),(0,t.jsx)(s.td,{children:"Cliente OpenAI (embeddings, chat completions)"})]})]})]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:"def test_exemplo(mock_openai_client):\n    mock_openai_client.embeddings.create.return_value.data[0].embedding = [0.1] * 1536\n    # ... teste ...\n"})}),"\n",(0,t.jsx)(s.h4,{id:"fixtures-de-dados",children:"Fixtures de Dados"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Fixture"}),(0,t.jsx)(s.th,{children:"Retorna"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"sample_query_vector"})}),(0,t.jsx)(s.td,{children:"Lista de 1536 floats"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"sample_blog_document"})}),(0,t.jsx)(s.td,{children:"Dict com estrutura de documento de blog"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"sample_conversa_document"})}),(0,t.jsx)(s.td,{children:"Dict com estrutura de conversa"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"sample_vertex_neighbors"})}),(0,t.jsx)(s.td,{children:"Lista de neighbors mockados"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"sample_source_docs"})}),(0,t.jsxs)(s.td,{children:["Lista de objetos ",(0,t.jsx)(s.code,{children:"SourceDoc"})]})]})]})]}),"\n",(0,t.jsxs)(s.h4,{id:"padr\xe3o-de-mocking-com-patch",children:["Padr\xe3o de Mocking com ",(0,t.jsx)(s.code,{children:"@patch"})]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:"@patch('main.search_neighbors')\n@patch('main.get_embedding')\n@pytest.mark.asyncio\nasync def test_exemplo(self, mock_embed, mock_search):\n    mock_embed.return_value = [0.1] * 1536\n    mock_search.return_value = [Mock(id=\"doc1_chk0\", distance=0.85)]\n    response = await chat(ChatRequest(pergunta=\"Teste?\"))\n    assert len(response.fontes) == 1\n"})}),"\n",(0,t.jsx)(s.h4,{id:"padr\xe3o-aaa",children:"Padr\xe3o AAA"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:'def test_exemplo():\n    # ARRANGE\n    entrada = "valor de teste"\n    esperado = "resultado esperado"\n\n    # ACT\n    resultado = funcao(entrada)\n\n    # ASSERT\n    assert resultado == esperado\n'})}),"\n",(0,t.jsx)(s.h3,{id:"16-cobertura-de-c\xf3digo",children:"1.6 Cobertura de C\xf3digo"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"# Relat\xf3rio no terminal\n./venv/bin/pytest tests/ --cov --cov-report=term-missing\n\n# Relat\xf3rio HTML interativo\n./venv/bin/pytest tests/ --cov --cov-report=html\nxdg-open htmlcov/index.html\n"})}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Status atual:"})," 88.53% (acima do threshold de 70%)."]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Interpreta\xe7\xe3o do relat\xf3rio:"})}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Stmts:"})," Total de linhas de c\xf3digo"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Miss:"})," Linhas n\xe3o testadas"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Cover:"})," Porcentagem de cobertura"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Missing:"})," N\xfameros das linhas n\xe3o testadas"]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"17-resolu\xe7\xe3o-de-problemas",children:"1.7 Resolu\xe7\xe3o de Problemas"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Problema"}),(0,t.jsx)(s.th,{children:"Causa"}),(0,t.jsx)(s.th,{children:"Solu\xe7\xe3o"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"pytest: command not found"})}),(0,t.jsx)(s.td,{children:"venv n\xe3o ativado"}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"source venv/bin/activate"})," ou usar ",(0,t.jsx)(s.code,{children:"./venv/bin/pytest"})]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"ModuleNotFoundError: No module named 'pytest'"})}),(0,t.jsx)(s.td,{children:"pytest n\xe3o instalado no venv"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"./venv/bin/pip install -r requirements-dev.txt"})})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"FileNotFoundError: pytest.ini"})}),(0,t.jsx)(s.td,{children:"Executando pytest no diret\xf3rio errado"}),(0,t.jsxs)(s.td,{children:["Executar a partir de ",(0,t.jsx)(s.code,{children:"arquitetura_RAG/"})]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"ImportError: cannot import name 'X'"})}),(0,t.jsx)(s.td,{children:"Caminho incorreto para m\xf3dulo"}),(0,t.jsxs)(s.td,{children:["Verificar ",(0,t.jsx)(s.code,{children:"sys.path.insert"})," no topo dos arquivos de teste"]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"Coverage.py warning: No data was collected"})}),(0,t.jsx)(s.td,{children:"Configura\xe7\xe3o incorreta"}),(0,t.jsxs)(s.td,{children:["Verificar ",(0,t.jsx)(s.code,{children:"pytest.ini"})," e rodar ",(0,t.jsx)(s.code,{children:"pytest --collect-only"})]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"FAILED coverage: 70% not reached"})}),(0,t.jsx)(s.td,{children:"Cobertura abaixo do threshold"}),(0,t.jsxs)(s.td,{children:["Adicionar mais testes ou usar ",(0,t.jsx)(s.code,{children:"--no-cov-fail"})," temporariamente"]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"PermissionError: htmlcov/index.html"})}),(0,t.jsx)(s.td,{children:"Arquivo aberto em outro programa"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"rm -rf htmlcov/ && pytest tests/ --cov --cov-report=html"})})]})]})]}),"\n",(0,t.jsx)(s.h3,{id:"18-boas-pr\xe1ticas",children:"1.8 Boas Pr\xe1ticas"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Antes de commitar:"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"./venv/bin/pytest tests/ -v          # todos os testes\n./venv/bin/pytest tests/ --cov       # verificar cobertura\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Nomenclatura:"})}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Arquivos: ",(0,t.jsx)(s.code,{children:"test_*.py"})]}),"\n",(0,t.jsxs)(s.li,{children:["Classes: ",(0,t.jsx)(s.code,{children:"Test*"})]}),"\n",(0,t.jsxs)(s.li,{children:["Fun\xe7\xf5es: ",(0,t.jsx)(s.code,{children:"test_*"})]}),"\n",(0,t.jsxs)(s.li,{children:["Nomes descritivos do comportamento testado (ex: ",(0,t.jsx)(s.code,{children:"test_blog_boost_applied_correctly"}),")"]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Marcadores \u2014 sempre categorizar:"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:'@pytest.mark.unit\n@pytest.mark.critical\ndef test_funcionalidade_critica():\n    """\n    Descri\xe7\xe3o do que est\xe1 sendo testado.\n    Cen\xe1rio: entrada \u2192 sa\xedda esperada.\n    """\n    ...\n'})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Mocking \u2014 nunca acessar APIs externas nos testes:"})}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Usar ",(0,t.jsx)(s.code,{children:"@patch('main.funcao')"})," para servi\xe7os (OpenAI, Firestore, Vertex AI)"]}),"\n",(0,t.jsxs)(s.li,{children:["Fixtures em ",(0,t.jsx)(s.code,{children:"conftest.py"})," para dados reutiliz\xe1veis"]}),"\n"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"2-iniciar-a-api-localmente",children:"2. Iniciar a API Localmente"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"cd arquitetura_RAG/app_rag\n../venv/bin/uvicorn main:app --reload --port 8000\n"})}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Swagger UI: ",(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.a,{href:"http://localhost:8000/docs",children:"http://localhost:8000/docs"})})]}),"\n",(0,t.jsxs)(s.li,{children:["OpenAPI JSON: ",(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.a,{href:"http://localhost:8000/openapi.json",children:"http://localhost:8000/openapi.json"})})]}),"\n"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"3-mapa-de-endpoints",children:"3. Mapa de Endpoints"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"#"}),(0,t.jsx)(s.th,{children:"Metodo"}),(0,t.jsx)(s.th,{children:"Rota"}),(0,t.jsx)(s.th,{children:"Descricao"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"1"}),(0,t.jsx)(s.td,{children:"POST"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"/knowledge/ingest/blog"})}),(0,t.jsx)(s.td,{children:"Ingestao de artigo (URL, arquivo ou texto). LLM infere metadados."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"2"}),(0,t.jsx)(s.td,{children:"POST"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"/knowledge/ingest/qa"})}),(0,t.jsx)(s.td,{children:"Ingestao de Q&A (arquivo ou texto). LLM infere metadados."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"3"}),(0,t.jsx)(s.td,{children:"POST"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"/knowledge/delete"})}),(0,t.jsx)(s.td,{children:"Exclusao unificada (1 ou mais IDs separados por virgula)"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"4"}),(0,t.jsx)(s.td,{children:"GET"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"/knowledge"})}),(0,t.jsx)(s.td,{children:"Listagem com paginacao"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"5"}),(0,t.jsx)(s.td,{children:"POST"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"/chat"})}),(0,t.jsx)(s.td,{children:"Busca RAG \u2014 retorna apenas fontes (sem resposta LLM)"})]})]})]}),"\n",(0,t.jsx)(s.h3,{id:"fluxo-de-ingestao",children:"Fluxo de ingestao"}),"\n",(0,t.jsx)(s.p,{children:"Ambos os endpoints de ingestao chamam o LLM automaticamente para inferir os metadados (titulo, categoria, tags). Para blogs, o LLM tambem reestrutura o conteudo em markdown limpo."}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"4-testes-via-terminal-curl",children:"4. Testes via Terminal (curl)"}),"\n",(0,t.jsx)(s.h3,{id:"41-ingerir-blog-via-url",children:"4.1 Ingerir Blog via URL"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'curl -s -X POST http://localhost:8000/knowledge/ingest/blog \\\n  -F "url=https://contabilizei.com.br/contabilidade/o-que-e-contabilidade" \\\n  | python3 -m json.tool\n'})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Resposta esperada:"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n    "status": "success",\n    "message": "Artigo ingerido com sucesso",\n    "documento": {\n        "id": "api_ingest_20260217XXXXXX_Titulo_Inferido_pela_LLM",\n        "tipo": "artigo",\n        "titulo": "Titulo extraido pela LLM da pagina",\n        "categoria": "Contabilidade",\n        "tags": ["contabilidade", "empresa", "CNPJ"],\n        "chunks_criados": 5,\n        "vetores_criados": 5,\n        "parents_criados": 3,\n        "resumo": "Resumo gerado pela LLM em 2-3 linhas."\n    }\n}\n'})}),"\n",(0,t.jsx)(s.h3,{id:"42-ingerir-blog-via-arquivo",children:"4.2 Ingerir Blog via Arquivo"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"cat > /tmp/artigo.md << 'EOF'\nMEI: tudo o que voce precisa saber\n\nO Microempreendedor Individual e a forma mais simples de formalizar\num negocio no Brasil. Oferece CNPJ, emissao de nota fiscal e beneficios.\n\nQuem pode ser MEI?\nProfissionais que faturam ate R$81 mil por ano e atuam em atividades permitidas.\n\nQuanto custa ser MEI?\nO DAS (boleto mensal) custa em torno de R$71 a R$75 por mes em 2026.\nEOF\n\ncurl -s -X POST http://localhost:8000/knowledge/ingest/blog \\\n  -F \"arquivo=@/tmp/artigo.md\" \\\n  | python3 -m json.tool\n"})}),"\n",(0,t.jsx)(s.h3,{id:"43-ingerir-blog-via-texto-raw",children:"4.3 Ingerir Blog via Texto Raw"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'curl -s -X POST http://localhost:8000/knowledge/ingest/blog \\\n  -F "conteudo=O Simples Nacional e um regime tributario simplificado para micro e pequenas empresas no Brasil. Ele unifica o pagamento de tributos em uma unica guia, o DAS. As empresas podem optar pelo Simples Nacional se tiverem faturamento ate R\\$4,8 milhoes por ano." \\\n  | python3 -m json.tool\n'})}),"\n",(0,t.jsx)(s.h3,{id:"44-ingerir-qa-via-texto-raw",children:"4.4 Ingerir Q&A via Texto Raw"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'curl -s -X POST http://localhost:8000/knowledge/ingest/qa \\\n  -F "conteudo=Pergunta: O que e o DAS do MEI? Resposta: O DAS (Documento de Arrecadacao do Simples Nacional) e o boleto mensal que todo MEI deve pagar para manter seu CNPJ ativo e ter acesso a beneficios previdenciarios. O valor em 2026 e de R\\$71 para comercio e R\\$75 para servicos." \\\n  | python3 -m json.tool\n'})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Resposta esperada:"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n    "status": "success",\n    "message": "Conhecimento Q&A ingerido com sucesso",\n    "documento": {\n        "id": "api_ingest_20260217XXXXXX_Titulo_Inferido_pela_LLM",\n        "tipo": "qa",\n        "titulo": "O que e o DAS do MEI e quanto custa",\n        "categoria": "Tributacao",\n        "tags": ["MEI", "DAS", "boleto"],\n        "chunks_criados": 1,\n        "vetores_criados": 1,\n        "parents_criados": null,\n        "resumo": null\n    }\n}\n'})}),"\n",(0,t.jsxs)(s.blockquote,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"ANOTE O ID RETORNADO"})," \u2014 voce vai precisar dele para exclusao."]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"45-ingerir-qa-via-upload-de-arquivo",children:"4.5 Ingerir Q&A via Upload de Arquivo"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'echo "Pergunta: Qual o prazo do DAS? Resposta: O prazo e ate o dia 20 de cada mes. Se cair no fim de semana ou feriado, o prazo antecipa para o ultimo dia util anterior." > /tmp/qa.txt\n\ncurl -s -X POST http://localhost:8000/knowledge/ingest/qa \\\n  -F "arquivo=@/tmp/qa.txt" \\\n  | python3 -m json.tool\n'})}),"\n",(0,t.jsx)(s.h3,{id:"46-verificar-no-chat",children:"4.6 Verificar no /chat"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'# Busca que deve retornar as fontes do conteudo recem-ingerido\ncurl -s -X POST http://localhost:8000/chat \\\n  -H "Content-Type: application/json" \\\n  -d \'{"pergunta": "O que e o DAS do MEI?"}\' | python3 -m json.tool\n\n# Filtrar apenas por blog\ncurl -s -X POST http://localhost:8000/chat \\\n  -H "Content-Type: application/json" \\\n  -d \'{"pergunta": "O que e o Simples Nacional?", "filtro_tipo": "blog"}\' | python3 -m json.tool\n'})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Resposta esperada:"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n    "fontes": [\n        {\n            "id": "api_ingest_20260219XXXXXX_titulo_secao",\n            "score": 0.92,\n            "conteudo": "Texto do chunk recuperado...",\n            "titulo": "Titulo do artigo",\n            "url": "https://contabilizei.com.br/...",\n            "tipo": "blog"\n        }\n    ]\n}\n'})}),"\n",(0,t.jsxs)(s.blockquote,{children:["\n",(0,t.jsxs)(s.p,{children:["O campo ",(0,t.jsx)(s.code,{children:"resposta"})," foi removido \u2014 o agente consumidor e responsavel por gerar a resposta final com base nas fontes."]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"47-listar-conhecimento",children:"4.7 Listar Conhecimento"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'# Listar todos\ncurl -s http://localhost:8000/knowledge | python3 -m json.tool\n\n# Filtrar por tipo\ncurl -s "http://localhost:8000/knowledge?tipo=conversa" | python3 -m json.tool   # Q&A e conversas\ncurl -s "http://localhost:8000/knowledge?tipo=blog" | python3 -m json.tool       # Artigos (alias: blog_section)\n\n# Com paginacao\ncurl -s "http://localhost:8000/knowledge?limit=10&offset=0" | python3 -m json.tool\n'})}),"\n",(0,t.jsxs)(s.blockquote,{children:["\n",(0,t.jsx)(s.p,{children:(0,t.jsxs)(s.strong,{children:["Valores do filtro ",(0,t.jsx)(s.code,{children:"tipo"}),":"]})}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"tipo=blog"})," ou ",(0,t.jsx)(s.code,{children:"tipo=blog_section"})," \u2014 retorna se\xe7\xf5es de artigos (",(0,t.jsx)(s.code,{children:'type == "blog_section"'}),")"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"tipo=conversa"})," \u2014 retorna Q&A e conversas (",(0,t.jsx)(s.code,{children:'type != "blog_section"'}),")"]}),"\n",(0,t.jsx)(s.li,{children:"sem filtro \u2014 retorna todos os documentos"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"48-valida\xe7\xf5es-de-seguran\xe7a",children:"4.8 Valida\xe7\xf5es de Seguran\xe7a"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'# URL para host interno bloqueado (anti-SSRF) \u2192 422\ncurl -s -X POST http://localhost:8000/knowledge/ingest/blog \\\n  -F "url=http://169.254.169.254/metadata" | python3 -m json.tool\n# {"detail": "URL aponta para recurso interno bloqueado."}\n\n# Protocolo inv\xe1lido \u2192 422\ncurl -s -X POST http://localhost:8000/knowledge/ingest/blog \\\n  -F "url=file:///etc/passwd" | python3 -m json.tool\n# {"detail": "Protocolo n\xe3o permitido: \'file\'. Use http ou https."}\n\n# Arquivo muito grande (> 100KB) \u2192 422\n# Conte\xfado muito curto (< 10 chars) \u2192 422\n# Extens\xe3o n\xe3o suportada (.csv, .pdf) \u2192 422\n'})}),"\n",(0,t.jsx)(s.h3,{id:"49-excluir-1-documento",children:"4.9 Excluir 1 Documento"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'curl -s -X POST http://localhost:8000/knowledge/delete \\\n  -H "Content-Type: application/json" \\\n  -d \'{"ids": "SEU_DOCUMENT_ID"}\' | python3 -m json.tool\n'})}),"\n",(0,t.jsx)(s.h3,{id:"410-excluir-multiplos-documentos",children:"4.10 Excluir Multiplos Documentos"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'curl -s -X POST http://localhost:8000/knowledge/delete \\\n  -H "Content-Type: application/json" \\\n  -d \'{"ids": "ID_1, ID_2, ID_3"}\' | python3 -m json.tool\n'})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Resposta esperada (todos removidos):"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n    "status": "success",\n    "message": "3 de 3 documentos removidos",\n    "total_solicitados": 3,\n    "total_removidos": 3,\n    "resultados": [\n        {"document_id": "ID_1", "tipo": "conversa", "status": "success"},\n        {"document_id": "ID_2", "tipo": "blog_section", "status": "success"},\n        {"document_id": "ID_3", "tipo": "conversa", "status": "success"}\n    ]\n}\n'})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"5-testes-via-swagger-ui",children:"5. Testes via Swagger UI"}),"\n",(0,t.jsxs)(s.p,{children:["Acesse ",(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.a,{href:"http://localhost:8000/docs",children:"http://localhost:8000/docs"})})]}),"\n",(0,t.jsx)(s.h3,{id:"51-ingerir-blog",children:"5.1 Ingerir Blog"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["Clique em ",(0,t.jsx)(s.strong,{children:"POST /knowledge/ingest/blog"}),' > "Try it out"']}),"\n",(0,t.jsxs)(s.li,{children:["Escolha o modo:","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"URL"}),": preencha apenas ",(0,t.jsx)(s.code,{children:"url"})," com a URL do artigo"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Arquivo"}),": no campo ",(0,t.jsx)(s.code,{children:"arquivo"}),', clique em "Choose File" e selecione ',(0,t.jsx)(s.code,{children:".txt"})," ou ",(0,t.jsx)(s.code,{children:".md"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Texto"}),": preencha apenas ",(0,t.jsx)(s.code,{children:"conteudo"})," com o texto raw"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.li,{children:'Clique "Execute"'}),"\n",(0,t.jsxs)(s.li,{children:["Verifique: status 201, ",(0,t.jsx)(s.code,{children:'"status": "success"'}),", titulo/categoria/tags inferidos"]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"52-ingerir-qa",children:"5.2 Ingerir Q&A"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["Clique em ",(0,t.jsx)(s.strong,{children:"POST /knowledge/ingest/qa"}),' > "Try it out"']}),"\n",(0,t.jsxs)(s.li,{children:["Escolha o modo:","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Arquivo"}),": selecione arquivo ",(0,t.jsx)(s.code,{children:".txt"})," ou ",(0,t.jsx)(s.code,{children:".md"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Texto"}),": preencha ",(0,t.jsx)(s.code,{children:"conteudo"})," com o texto do Q&A"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.li,{children:'Clique "Execute"'}),"\n",(0,t.jsxs)(s.li,{children:["Verifique: status 201, ",(0,t.jsx)(s.code,{children:'"chunks_criados": 1'}),", titulo/categoria/tags inferidos"]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"53-excluir-documentos",children:"5.3 Excluir Documentos"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["Clique em ",(0,t.jsx)(s.strong,{children:"POST /knowledge/delete"}),' > "Try it out"']}),"\n",(0,t.jsx)(s.li,{children:"Cole no body:"}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{"ids": "SEU_ID_AQUI"}\n'})}),"\n",(0,t.jsx)(s.p,{children:"Ou multiplos:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{"ids": "ID_1, ID_2, ID_3"}\n'})}),"\n",(0,t.jsxs)(s.ol,{start:"3",children:["\n",(0,t.jsx)(s.li,{children:'Clique "Execute"'}),"\n",(0,t.jsxs)(s.li,{children:["Verifique: ",(0,t.jsx)(s.code,{children:"total_removidos"})," == numero de IDs validos"]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"54-chat",children:"5.4 Chat"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["Clique em ",(0,t.jsx)(s.strong,{children:"POST /chat"}),' > "Try it out"']}),"\n",(0,t.jsx)(s.li,{children:"Cole no body:"}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n  "pergunta": "O que e o DAS do MEI?"\n}\n'})}),"\n",(0,t.jsxs)(s.ol,{start:"3",children:["\n",(0,t.jsx)(s.li,{children:'Clique "Execute"'}),"\n",(0,t.jsxs)(s.li,{children:["Verifique: response contem campo ",(0,t.jsx)(s.code,{children:"fontes"})," com documentos relevantes (sem campo ",(0,t.jsx)(s.code,{children:"resposta"}),")"]}),"\n"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"6-testes-via-postman",children:"6. Testes via Postman"}),"\n",(0,t.jsx)(s.h3,{id:"61-configuracao-inicial",children:"6.1 Configuracao Inicial"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["Abra o Postman e crie uma nova Collection: ",(0,t.jsx)(s.strong,{children:'"Contabilizei RAG API"'})]}),"\n",(0,t.jsxs)(s.li,{children:["Crie uma variavel de ambiente ",(0,t.jsx)(s.code,{children:"baseUrl"})," com valor ",(0,t.jsx)(s.code,{children:"http://localhost:8000"})]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"62-ingerir-blog-via-url",children:"6.2 Ingerir Blog via URL"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Metodo"}),": POST"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"URL"}),": ",(0,t.jsx)(s.code,{children:"{{baseUrl}}/knowledge/ingest/blog"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Body"}),": selecione ",(0,t.jsx)(s.code,{children:"form-data"})]}),"\n"]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Key"}),(0,t.jsx)(s.th,{children:"Value"}),(0,t.jsx)(s.th,{children:"Type"})]})}),(0,t.jsx)(s.tbody,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"url"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.a,{href:"https://contabilizei.com.br/contabilidade/o-que-e-contabilidade",children:"https://contabilizei.com.br/contabilidade/o-que-e-contabilidade"})}),(0,t.jsx)(s.td,{children:"Text"})]})})]}),"\n",(0,t.jsxs)(s.p,{children:["Clique em ",(0,t.jsx)(s.strong,{children:"Send"}),"."]}),"\n",(0,t.jsx)(s.h3,{id:"63-ingerir-blog-via-arquivo",children:"6.3 Ingerir Blog via Arquivo"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Metodo"}),": POST"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"URL"}),": ",(0,t.jsx)(s.code,{children:"{{baseUrl}}/knowledge/ingest/blog"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Body"}),": selecione ",(0,t.jsx)(s.code,{children:"form-data"})]}),"\n"]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Key"}),(0,t.jsx)(s.th,{children:"Value"}),(0,t.jsx)(s.th,{children:"Type"})]})}),(0,t.jsx)(s.tbody,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"arquivo"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.em,{children:"selecione o arquivo .txt ou .md"})}),(0,t.jsx)(s.td,{children:"File"})]})})]}),"\n",(0,t.jsxs)(s.blockquote,{children:["\n",(0,t.jsxs)(s.p,{children:["No campo ",(0,t.jsx)(s.code,{children:"Type"})," da linha ",(0,t.jsx)(s.code,{children:"arquivo"}),", mude de ",(0,t.jsx)(s.code,{children:"Text"})," para ",(0,t.jsx)(s.code,{children:"File"}),', depois clique em "Select Files".']}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"64-ingerir-blog-via-texto-raw",children:"6.4 Ingerir Blog via Texto Raw"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Metodo"}),": POST"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"URL"}),": ",(0,t.jsx)(s.code,{children:"{{baseUrl}}/knowledge/ingest/blog"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Body"}),": selecione ",(0,t.jsx)(s.code,{children:"form-data"})]}),"\n"]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Key"}),(0,t.jsx)(s.th,{children:"Value"}),(0,t.jsx)(s.th,{children:"Type"})]})}),(0,t.jsx)(s.tbody,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"conteudo"}),(0,t.jsx)(s.td,{children:"O Simples Nacional e um regime tributario para PMEs..."}),(0,t.jsx)(s.td,{children:"Text"})]})})]}),"\n",(0,t.jsx)(s.h3,{id:"65-ingerir-qa-via-texto-raw",children:"6.5 Ingerir Q&A via Texto Raw"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Metodo"}),": POST"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"URL"}),": ",(0,t.jsx)(s.code,{children:"{{baseUrl}}/knowledge/ingest/qa"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Body"}),": selecione ",(0,t.jsx)(s.code,{children:"form-data"})]}),"\n"]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Key"}),(0,t.jsx)(s.th,{children:"Value"}),(0,t.jsx)(s.th,{children:"Type"})]})}),(0,t.jsx)(s.tbody,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"conteudo"}),(0,t.jsx)(s.td,{children:"Pergunta: O que e o DAS? Resposta: O DAS e o boleto mensal do MEI."}),(0,t.jsx)(s.td,{children:"Text"})]})})]}),"\n",(0,t.jsx)(s.h3,{id:"66-ingerir-qa-via-arquivo",children:"6.6 Ingerir Q&A via Arquivo"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Metodo"}),": POST"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"URL"}),": ",(0,t.jsx)(s.code,{children:"{{baseUrl}}/knowledge/ingest/qa"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Body"}),": selecione ",(0,t.jsx)(s.code,{children:"form-data"})]}),"\n"]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Key"}),(0,t.jsx)(s.th,{children:"Value"}),(0,t.jsx)(s.th,{children:"Type"})]})}),(0,t.jsx)(s.tbody,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"arquivo"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.em,{children:"selecione o arquivo .txt ou .md"})}),(0,t.jsx)(s.td,{children:"File"})]})})]}),"\n",(0,t.jsx)(s.h3,{id:"67-excluir-documentos",children:"6.7 Excluir Documentos"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Metodo"}),": POST"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"URL"}),": ",(0,t.jsx)(s.code,{children:"{{baseUrl}}/knowledge/delete"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Body"}),": selecione ",(0,t.jsx)(s.code,{children:"raw"})," + ",(0,t.jsx)(s.code,{children:"JSON"})]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n  "ids": "api_ingest_20260217XXXXXX_titulo"\n}\n'})}),"\n",(0,t.jsx)(s.p,{children:"Para multiplos:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n  "ids": "ID_1, ID_2, ID_3"\n}\n'})}),"\n",(0,t.jsx)(s.h3,{id:"68-listar-conhecimento",children:"6.8 Listar Conhecimento"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Metodo"}),": GET"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"URL"}),": ",(0,t.jsx)(s.code,{children:"{{baseUrl}}/knowledge"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Params"})," (opcional):"]}),"\n"]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Key"}),(0,t.jsx)(s.th,{children:"Value"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"tipo"}),(0,t.jsx)(s.td,{children:"conversa"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"limit"}),(0,t.jsx)(s.td,{children:"10"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"offset"}),(0,t.jsx)(s.td,{children:"0"})]})]})]}),"\n",(0,t.jsx)(s.h3,{id:"69-chat",children:"6.9 Chat"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Metodo"}),": POST"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"URL"}),": ",(0,t.jsx)(s.code,{children:"{{baseUrl}}/chat"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Body"}),": selecione ",(0,t.jsx)(s.code,{children:"raw"})," + ",(0,t.jsx)(s.code,{children:"JSON"})]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n  "pergunta": "O que e o DAS do MEI?"\n}\n'})}),"\n",(0,t.jsx)(s.h3,{id:"610-dicas-no-postman",children:"6.10 Dicas no Postman"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Salvar IDs"}),': no painel "Tests" de cada requisicao de ingestao, cole o script para salvar o ID automaticamente:']}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-javascript",children:'const json = pm.response.json();\npm.environment.set("last_doc_id", json.documento.id);\n'})}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Depois use ",(0,t.jsx)(s.code,{children:"{{last_doc_id}}"})," nos campos de exclusao."]}),"\n"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"7-verificacao-direta-no-google-cloud",children:"7. Verificacao Direta no Google Cloud"}),"\n",(0,t.jsx)(s.h3,{id:"71-firestore",children:"7.1 Firestore"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Via Console Web:"})}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["Acesse ",(0,t.jsx)(s.a,{href:"https://console.cloud.google.com/firestore",children:"https://console.cloud.google.com/firestore"})]}),"\n",(0,t.jsxs)(s.li,{children:["Projeto: ",(0,t.jsx)(s.code,{children:"ctbz-ia-assessoria-poc"})," | Banco: ",(0,t.jsx)(s.code,{children:"rag-db-v1"})]}),"\n",(0,t.jsxs)(s.li,{children:["Collection: ",(0,t.jsx)(s.code,{children:"knowledge_base"})]}),"\n",(0,t.jsxs)(s.li,{children:["Verifique campos: ",(0,t.jsx)(s.code,{children:"type"}),", ",(0,t.jsx)(s.code,{children:"source"}),", ",(0,t.jsx)(s.code,{children:"base_article_id"})," (artigos), ",(0,t.jsx)(s.code,{children:"metadata.categoria"}),", ",(0,t.jsx)(s.code,{children:"metadata.tags"})]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Via Python:"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:'from google.cloud import firestore\ndb = firestore.Client(project="ctbz-ia-assessoria-poc", database="rag-db-v1")\n\n# Listar ingestoes via API\ndocs = db.collection("knowledge_base") \\\n    .where("source", "==", "api_ingest_v1") \\\n    .limit(20).stream()\n\nfor doc in docs:\n    d = doc.to_dict()\n    print(f"{doc.id} | {d.get(\'type\')} | {d.get(\'title\',\'\')[:60]}")\n    print(f"  categoria: {d.get(\'metadata\', {}).get(\'categoria\')}")\n    print(f"  tags: {d.get(\'metadata\', {}).get(\'tags\')}")\n'})}),"\n",(0,t.jsx)(s.h3,{id:"72-vertex-ai-vector-search",children:"7.2 Vertex AI Vector Search"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Via gcloud:"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"gcloud ai indexes describe 2352965878556917760 \\\n  --region=us-central1 \\\n  --project=ctbz-ia-assessoria-poc\n"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"8-checklist-de-verificacao-final",children:"8. Checklist de Verificacao Final"}),"\n",(0,t.jsx)(s.h3,{id:"testes-automatizados",children:"Testes Automatizados"}),"\n",(0,t.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,t.jsx)(s.code,{children:"./venv/bin/pytest tests/ -v"})," - Todos os testes passam"]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Cobertura >= 70%"]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"blog--url",children:"Blog \u2014 URL"}),"\n",(0,t.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,t.jsx)(s.code,{children:"POST /knowledge/ingest/blog"})," com ",(0,t.jsx)(s.code,{children:"url"})," retorna 201"]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","LLM infere titulo, categoria, tags e resumo automaticamente"]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,t.jsx)(s.code,{children:"parents_criados >= 1"}),", ",(0,t.jsx)(s.code,{children:"chunks_criados >= 1"})]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,t.jsx)(s.code,{children:"/chat"})," retorna o conteudo quando pergunta relacionada"]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"blog--arquivo--texto",children:"Blog \u2014 Arquivo / Texto"}),"\n",(0,t.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,t.jsx)(s.code,{children:"POST /knowledge/ingest/blog"})," com ",(0,t.jsx)(s.code,{children:"arquivo"})," (.md) retorna 201"]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,t.jsx)(s.code,{children:"POST /knowledge/ingest/blog"})," com ",(0,t.jsx)(s.code,{children:"conteudo"})," retorna 201"]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","LLM reestrutura o conteudo em markdown"]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Extensao invalida (.csv) retorna 422"]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"qa--arquivo--texto",children:"Q&A \u2014 Arquivo / Texto"}),"\n",(0,t.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,t.jsx)(s.code,{children:"POST /knowledge/ingest/qa"})," com ",(0,t.jsx)(s.code,{children:"conteudo"})," retorna 201"]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,t.jsx)(s.code,{children:"POST /knowledge/ingest/qa"})," com ",(0,t.jsx)(s.code,{children:"arquivo"})," (.txt) retorna 201"]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","LLM infere titulo, categoria e tags"]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,t.jsx)(s.code,{children:"chunks_criados == 1"}),", ",(0,t.jsx)(s.code,{children:"vetores_criados == 1"})]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,t.jsx)(s.code,{children:"/chat"})," retorna o conteudo quando pergunta relacionada"]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"exclusao",children:"Exclusao"}),"\n",(0,t.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,t.jsx)(s.code,{children:"POST /knowledge/delete"})," com 1 ID remove corretamente"]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,t.jsx)(s.code,{children:"POST /knowledge/delete"})," com N IDs (comma-separated) remove todos"]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","ID inexistente retorna ",(0,t.jsx)(s.code,{children:'"status": "partial"'})," com mensagem de erro"]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Exclusao de artigo remove todos os parents + vetores"]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,t.jsx)(s.code,{children:"/chat"})," NAO retorna conteudo excluido"]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"listagem-e-chat",children:"Listagem e Chat"}),"\n",(0,t.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,t.jsx)(s.code,{children:"GET /knowledge"})," retorna lista paginada"]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,t.jsx)(s.code,{children:"GET /knowledge?tipo=conversa"})," filtra corretamente"]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,t.jsx)(s.code,{children:"/chat"})," retorna ",(0,t.jsx)(s.code,{children:'{"fontes": [...]}'})," com documentos relevantes"]}),"\n",(0,t.jsxs)(s.li,{className:"task-list-item",children:[(0,t.jsx)(s.input,{type:"checkbox",disabled:!0})," ",(0,t.jsx)(s.code,{children:"/chat"})," sem resultados retorna ",(0,t.jsx)(s.code,{children:'{"fontes": []}'})]}),"\n"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"9-logs-de-observabilidade",children:"9. Logs de Observabilidade"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"# Blog via URL\nINFO: Ingestao blog URL: url='https://...'\nINFO: Inferindo metadados de blog via LLM (gpt-4o-mini), content_len=5234\nINFO: Metadados blog inferidos: titulo='...' categoria='...' tags=[...]\nINFO: Ingestao blog concluida: id=... titulo='...' chunks=5 duration_ms=3210\n\n# Q&A via texto\nINFO: Ingestao Q&A texto\nINFO: Inferindo metadados de Q&A via LLM (gpt-4o-mini), content_len=342\nINFO: Metadados Q&A inferidos: titulo='...' categoria='...' tags=[...]\nINFO: Ingestao Q&A concluida: id=... titulo='...' duration_ms=1450\n\n# Exclusao\nINFO: Exclusao: 2 documento(s) solicitado(s)\nINFO: Exclusao concluida: 2/2 removidos duration_ms=890\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Metricas de performance esperadas:"})}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Ingestao Q&A: < 5.000ms (inclui chamada LLM)"}),"\n",(0,t.jsx)(s.li,{children:"Ingestao blog (10 secoes): < 30.000ms (inclui chamada LLM)"}),"\n",(0,t.jsx)(s.li,{children:"Ingestao via URL: < 60.000ms (inclui download + LLM)"}),"\n",(0,t.jsx)(s.li,{children:"Exclusao unitaria: < 10.000ms"}),"\n",(0,t.jsx)(s.li,{children:"Exclusao em lote (10 IDs): < 30.000ms"}),"\n",(0,t.jsx)(s.li,{children:"Chat (busca RAG): < 2.000ms (sem chamada LLM)"}),"\n"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"10-integracao-com-o-agente-do-pedro-cloud-run",children:"10. Integracao com o Agente do Pedro (Cloud Run)"}),"\n",(0,t.jsx)(s.h3,{id:"url-base-da-api-producao",children:"URL Base da API (producao)"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"https://rag-api-55837972640.us-central1.run.app\n"})}),"\n",(0,t.jsxs)(s.blockquote,{children:["\n",(0,t.jsxs)(s.p,{children:["Nao use a URL do Swagger (",(0,t.jsx)(s.code,{children:"/docs"}),") \u2014 use a URL base acima."]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"autenticacao-service-to-service-gcp",children:"Autenticacao (service-to-service GCP)"}),"\n",(0,t.jsxs)(s.p,{children:["O servico esta privado. O agente do Pedro (",(0,t.jsx)(s.code,{children:"agente-contabil"}),") ja tem permissao ",(0,t.jsx)(s.code,{children:"roles/run.invoker"}),".\nA autenticacao e feita via token OIDC da service account do Cloud Run \u2014 sem configuracao adicional."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:'import google.auth.transport.requests\nfrom google.oauth2 import id_token\nimport requests\n\nRAG_URL = "https://rag-api-55837972640.us-central1.run.app"\n\ndef buscar_fontes(pergunta: str, filtro_tipo: str = None) -> list[dict]:\n    auth_req = google.auth.transport.requests.Request()\n    token = id_token.fetch_id_token(auth_req, RAG_URL)\n\n    payload = {"pergunta": pergunta}\n    if filtro_tipo:\n        payload["filtro_tipo"] = filtro_tipo  # "blog" ou "conversa"\n\n    response = requests.post(\n        f"{RAG_URL}/chat",\n        json=payload,\n        headers={"Authorization": f"Bearer {token}"},\n        timeout=10,\n    )\n    response.raise_for_status()\n    return response.json()["fontes"]\n'})}),"\n",(0,t.jsx)(s.h3,{id:"campos-de-cada-fonte-retornada",children:"Campos de cada fonte retornada"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Campo"}),(0,t.jsx)(s.th,{children:"Tipo"}),(0,t.jsx)(s.th,{children:"Descricao"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"id"})}),(0,t.jsx)(s.td,{children:"str"}),(0,t.jsx)(s.td,{children:"ID do documento no Firestore"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"score"})}),(0,t.jsx)(s.td,{children:"float"}),(0,t.jsx)(s.td,{children:"Relevancia (0.50 a ~1.15)"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"conteudo"})}),(0,t.jsx)(s.td,{children:"str"}),(0,t.jsx)(s.td,{children:"Texto do chunk recuperado"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"titulo"})}),(0,t.jsx)(s.td,{children:"str"}),(0,t.jsx)(s.td,{children:"Titulo do artigo ou arquivo"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"url"})}),(0,t.jsx)(s.td,{children:"str ou null"}),(0,t.jsx)(s.td,{children:"URL original (blogs)"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"tipo"})}),(0,t.jsx)(s.td,{children:"str"}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:'"blog"'})," ou ",(0,t.jsx)(s.code,{children:'"conversa"'})]})]})]})]})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>d,x:()=>o});var i=n(6540);const t={},r=i.createContext(t);function d(e){const s=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),i.createElement(r.Provider,{value:s},e.children)}}}]);