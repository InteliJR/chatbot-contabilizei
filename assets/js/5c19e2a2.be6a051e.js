"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[521],{4416:(e,n,i)=>{i.d(n,{A:()=>a});const a=i.p+"assets/images/arquitetura_ETL_conversas-8d8ea08d61b3cbbac52184f63ee3dfdc.png"},6688:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>m,frontMatter:()=>o,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"Documenta\xe7\xf5es de Desenvolvimento/arquitetura_ELT_conversa","title":"Documenta\xe7\xe3o T\xe9cnica: Pipeline de Ingest\xe3o de Conhecimento (ETL de Conversas)","description":"1. Vis\xe3o Geral","source":"@site/docs/Documenta\xe7\xf5es de Desenvolvimento/arquitetura_ELT_conversa.md","sourceDirName":"Documenta\xe7\xf5es de Desenvolvimento","slug":"/Documenta\xe7\xf5es de Desenvolvimento/arquitetura_ELT_conversa","permalink":"/chatbot-contabilizei/docs/Documenta\xe7\xf5es de Desenvolvimento/arquitetura_ELT_conversa","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Documenta\xe7\xe3o T\xe9cnica: Pipeline de Ingest\xe3o de Artigos (ETL Blog)","permalink":"/chatbot-contabilizei/docs/Documenta\xe7\xf5es de Desenvolvimento/arquitetura_ELT_blog"},"next":{"title":"Arquitetura T\xe9cnica do Sistema RAG: Agente de Intelig\xeancia Contabilizei","permalink":"/chatbot-contabilizei/docs/Documenta\xe7\xf5es de Desenvolvimento/arquitetura_geral_detalhada"}}');var s=i(4848),t=i(8453);const o={},r="Documenta\xe7\xe3o T\xe9cnica: Pipeline de Ingest\xe3o de Conhecimento (ETL de Conversas)",d={},l=[{value:"1. Vis\xe3o Geral",id:"1-vis\xe3o-geral",level:2},{value:"2. Arquitetura L\xf3gica",id:"2-arquitetura-l\xf3gica",level:2},{value:"Componentes Chave:",id:"componentes-chave",level:3},{value:"3. Estrat\xe9gia de Engenharia de Dados",id:"3-estrat\xe9gia-de-engenharia-de-dados",level:2},{value:"3.1. Idempot\xeancia e &quot;Smart Resume&quot;",id:"31-idempot\xeancia-e-smart-resume",level:3},{value:"3.2. Resili\xeancia de API (Exponential Backoff)",id:"32-resili\xeancia-de-api-exponential-backoff",level:3},{value:"3.3. Higieniza\xe7\xe3o de Links (Strict URL Policy)",id:"33-higieniza\xe7\xe3o-de-links-strict-url-policy",level:3},{value:"4. Estrat\xe9gia Cognitiva (System Prompt V4)",id:"4-estrat\xe9gia-cognitiva-system-prompt-v4",level:2},{value:"5. Especifica\xe7\xe3o de Sa\xedda (Output Schema)",id:"5-especifica\xe7\xe3o-de-sa\xedda-output-schema",level:2},{value:"Estrutura de Diret\xf3rios",id:"estrutura-de-diret\xf3rios",level:3},{value:"Modelo do Arquivo Markdown",id:"modelo-do-arquivo-markdown",level:3},{value:"6. Como Executar",id:"6-como-executar",level:2},{value:"Comando",id:"comando",level:3},{value:"Monitoramento",id:"monitoramento",level:3}];function c(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"documenta\xe7\xe3o-t\xe9cnica-pipeline-de-ingest\xe3o-de-conhecimento-etl-de-conversas",children:"Documenta\xe7\xe3o T\xe9cnica: Pipeline de Ingest\xe3o de Conhecimento (ETL de Conversas)"})}),"\n",(0,s.jsx)(n.h2,{id:"1-vis\xe3o-geral",children:"1. Vis\xe3o Geral"}),"\n",(0,s.jsx)(n.p,{children:"Este documento detalha a arquitetura do subsistema de ETL (Extract, Transform, Load) respons\xe1vel por processar o hist\xf3rico de atendimento n\xe3o estruturado (conversas humanas) e transform\xe1-lo em uma Base de Conhecimento (Knowledge Base) estruturada e semanticamente rica para o sistema RAG."}),"\n",(0,s.jsx)(n.p,{children:'O objetivo \xe9 converter "logs de chat sujos" em artefatos de conhecimento at\xf4micos, higienizados e index\xe1veis.'}),"\n",(0,s.jsx)(n.h2,{id:"2-arquitetura-l\xf3gica",children:"2. Arquitetura L\xf3gica"}),"\n",(0,s.jsxs)(n.p,{children:["A solu\xe7\xe3o opera em regime ",(0,s.jsx)(n.em,{children:"Batch"})," (processamento em lote), desenhada com foco em resili\xeancia a falhas de rede e consist\xeancia de dados."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.img,{alt:"Fluxograma da Arquitetura",src:i(4416).A+"",width:"4365",height:"8192"}),"\n",(0,s.jsx)(n.em,{children:"Figura 1: Fluxo de Dados do Pipeline de Conversas"})]}),"\n",(0,s.jsx)(n.h3,{id:"componentes-chave",children:"Componentes Chave:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Ingest\xe3o Resiliente:"})," Leitura segura de CSV sem cabe\xe7alho e verifica\xe7\xe3o de integridade m\xednima."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"N\xfacleo Cognitivo (GPT-4o):"})," Extra\xe7\xe3o sem\xe2ntica utilizando ",(0,s.jsx)(n.em,{children:"Dual-Layer Strategy"})," (Macro/Micro) e valida\xe7\xe3o estrita de PII (Dados Pessoais)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Persist\xeancia Estruturada:"})," Gera\xe7\xe3o de arquivos Markdown com metadados (Frontmatter) organizados por diret\xf3rios."]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"3-estrat\xe9gia-de-engenharia-de-dados",children:"3. Estrat\xe9gia de Engenharia de Dados"}),"\n",(0,s.jsx)(n.p,{children:"Para garantir robustez em ambiente de produ\xe7\xe3o, foram implementados os seguintes padr\xf5es de design (Design Patterns):"}),"\n",(0,s.jsx)(n.h3,{id:"31-idempot\xeancia-e-smart-resume",children:'3.1. Idempot\xeancia e "Smart Resume"'}),"\n",(0,s.jsx)(n.p,{children:"O sistema verifica a exist\xeancia do diret\xf3rio de sa\xedda antes de processar cada registro."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Comportamento:"})," Se a pasta ",(0,s.jsx)(n.code,{children:"knowledge_base_rag/linha_042"})," j\xe1 existe, o script entende que o registro foi processado com sucesso e ",(0,s.jsx)(n.strong,{children:"pula"})," para o pr\xf3ximo."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Benef\xedcio:"})," Permite reiniciar o processamento ap\xf3s falhas (ex: queda de internet) sem duplicar custos de API ou reprocessar dados j\xe1 consolidados."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"32-resili\xeancia-de-api-exponential-backoff",children:"3.2. Resili\xeancia de API (Exponential Backoff)"}),"\n",(0,s.jsxs)(n.p,{children:["Implementa\xe7\xe3o de um ",(0,s.jsx)(n.em,{children:"decorator"})," de retentativa para chamadas \xe0 API da OpenAI."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"L\xf3gica:"})," Em caso de ",(0,s.jsx)(n.code,{children:"RateLimitError"})," (429) ou instabilidade (5xx), o sistema aguarda progressivamente (15s, 30s, 45s) antes de falhar definitivamente."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Fallback:"})," Erros irrecuper\xe1veis s\xe3o logados, mas n\xe3o interrompem o lote inteiro."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"33-higieniza\xe7\xe3o-de-links-strict-url-policy",children:"3.3. Higieniza\xe7\xe3o de Links (Strict URL Policy)"}),"\n",(0,s.jsx)(n.p,{children:'Para evitar "alucina\xe7\xf5es" de links quebrados comuns em LLMs:'}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:'Links incompletos (com "...") s\xe3o descartados na origem.'}),"\n",(0,s.jsx)(n.li,{children:"Apenas URLs v\xe1lidas s\xe3o persistidas no campo de metadados."}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"4-estrat\xe9gia-cognitiva-system-prompt-v4",children:"4. Estrat\xe9gia Cognitiva (System Prompt V4)"}),"\n",(0,s.jsxs)(n.p,{children:["Utilizamos uma abordagem de ",(0,s.jsx)(n.strong,{children:"Minera\xe7\xe3o de Conhecimento em Dupla Camada"})," para maximizar a recupera\xe7\xe3o (Retrieval) futura:"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"Tipo"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"Descri\xe7\xe3o"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"Objetivo no RAG"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.strong,{children:"MACRO (Panorama)"})}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Pergunta abrangente que resume o t\xf3pico inteiro da conversa."}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:'Capturar inten\xe7\xf5es gen\xe9ricas ("Como funciona o DAS?").'})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:(0,s.jsx)(n.strong,{children:"MICRO (At\xf4mica)"})}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Perguntas espec\xedficas sobre detalhes citados (taxas, prazos, regras)."}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:'Capturar d\xfavidas precisas ("Qual a multa do DAS?").'})]})]})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Regras de Compliance aplicadas via Prompt:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Anonimiza\xe7\xe3o:"})," Remo\xe7\xe3o total de nomes, CPFs e valores financeiros do cliente."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Auditoria de Pre\xe7os:"}),' Substitui\xe7\xe3o de valores comerciais fixos por termos din\xe2micos ("consulte tabela").']}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"5-especifica\xe7\xe3o-de-sa\xedda-output-schema",children:"5. Especifica\xe7\xe3o de Sa\xedda (Output Schema)"}),"\n",(0,s.jsxs)(n.p,{children:["Os dados s\xe3o persistidos em arquivos ",(0,s.jsx)(n.code,{children:".md"})," (Markdown) contendo um cabe\xe7alho YAML (Frontmatter) para facilitar a indexa\xe7\xe3o no Vertex AI Search."]}),"\n",(0,s.jsx)(n.h3,{id:"estrutura-de-diret\xf3rios",children:"Estrutura de Diret\xf3rios"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"/knowledge_base_rag\n    \u251c\u2500\u2500 /linha_001/\n    \u2502     \u251c\u2500\u2500 00_MACRO_Titulo_do_Topico.md\n    \u2502     \u251c\u2500\u2500 01_MICRO_Detalhe_Especifico_1.md\n    \u2502     \u2514\u2500\u2500 02_MICRO_Detalhe_Especifico_2.md\n    \u251c\u2500\u2500 /linha_002/\n    \u2502     \u2514\u2500\u2500 ...\n"})}),"\n",(0,s.jsx)(n.h3,{id:"modelo-do-arquivo-markdown",children:"Modelo do Arquivo Markdown"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'source_row: 10\nqa_id: 1\ncategory: "Tributa\xe7\xe3o"\ntags: ["Simples Nacional", "DAS", "Multas"]\nlinks: ["[https://contabilizei.com.br/blog/das](https://contabilizei.com.br/blog/das)"]\ntype: "MICRO"\n-----\n\n# T\xedtulo da Pergunta (H1)\n\nTexto da resposta t\xe9cnica, higienizada e revisada pela IA...\n\n**Links \xdateis:**\n- https://contabilizei.com.br/blog/das\n\n'})}),"\n",(0,s.jsx)(n.h2,{id:"6-como-executar",children:"6. Como Executar"}),"\n",(0,s.jsx)(n.p,{children:"Pr\xe9-requisitos"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Python 3.10+"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Bibliotecas: pandas, openai, pydantic"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Vari\xe1vel de ambiente OPENAI_API_KEY configurada."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"comando",children:"Comando"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-py",children:"python etl_production.py\n"})}),"\n",(0,s.jsx)(n.h3,{id:"monitoramento",children:"Monitoramento"}),"\n",(0,s.jsx)(n.p,{children:"O script emite logs estruturados no console ([INFO], [PROCESS], [SUCCESS]) para acompanhamento em tempo real."})]})}function m(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>r});var a=i(6540);const s={},t=a.createContext(s);function o(e){const n=a.useContext(t);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),a.createElement(t.Provider,{value:n},e.children)}}}]);