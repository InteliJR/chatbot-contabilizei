"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[31],{1692:(e,a,o)=>{o.d(a,{A:()=>s});const s=o.p+"assets/images/arquitetura_ETL_blog-8e2dcaff88c37c1db1be635fb353d6c4.png"},6614:(e,a,o)=>{o.r(a),o.d(a,{assets:()=>d,contentTitle:()=>t,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"Documenta\xe7\xf5es de Desenvolvimento/arquitetura_ELT_blog","title":"Documenta\xe7\xe3o T\xe9cnica: Pipeline de Ingest\xe3o de Artigos (ETL Blog)","description":"1. Vis\xe3o Geral","source":"@site/docs/Documenta\xe7\xf5es de Desenvolvimento/arquitetura_ELT_blog.md","sourceDirName":"Documenta\xe7\xf5es de Desenvolvimento","slug":"/Documenta\xe7\xf5es de Desenvolvimento/arquitetura_ELT_blog","permalink":"/chatbot-contabilizei/docs/Documenta\xe7\xf5es de Desenvolvimento/arquitetura_ELT_blog","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Guia de Verifica\xe7\xe3o \u2014 API de Conhecimento RAG + Sistema de Testes","permalink":"/chatbot-contabilizei/docs/Documenta\xe7\xf5es de Desenvolvimento/Guia_teste_pipeline_documentos"},"next":{"title":"Documenta\xe7\xe3o T\xe9cnica: Pipeline de Ingest\xe3o de Conhecimento (ETL de Conversas)","permalink":"/chatbot-contabilizei/docs/Documenta\xe7\xf5es de Desenvolvimento/arquitetura_ELT_conversa"}}');var n=o(4848),i=o(8453);const r={},t="Documenta\xe7\xe3o T\xe9cnica: Pipeline de Ingest\xe3o de Artigos (ETL Blog)",d={},l=[{value:"1. Vis\xe3o Geral",id:"1-vis\xe3o-geral",level:2},{value:"2. Arquitetura e Fluxo de Dados",id:"2-arquitetura-e-fluxo-de-dados",level:2},{value:"O Fluxo Passo a Passo:",id:"o-fluxo-passo-a-passo",level:3},{value:"3. L\xf3gica e Decis\xf5es T\xe9cnicas",id:"3-l\xf3gica-e-decis\xf5es-t\xe9cnicas",level:2},{value:"3.1. Abordagem H\xedbrida (Python + LLM)",id:"31-abordagem-h\xedbrida-python--llm",level:3},{value:"3.2. Preserva\xe7\xe3o da Data de Atualiza\xe7\xe3o",id:"32-preserva\xe7\xe3o-da-data-de-atualiza\xe7\xe3o",level:3},{value:"3.3. Idempot\xeancia (Smart Resume)",id:"33-idempot\xeancia-smart-resume",level:3},{value:"4. Ferramentas de Diagn\xf3stico: <code>inspect_html.py</code>",id:"4-ferramentas-de-diagn\xf3stico-inspect_htmlpy",level:2},{value:"5. Exemplo de Output",id:"5-exemplo-de-output",level:2},{value:"6. Guia de Opera\xe7\xe3o",id:"6-guia-de-opera\xe7\xe3o",level:2},{value:"Pr\xe9-requisitos:",id:"pr\xe9-requisitos",level:3},{value:"Como Executar o Pipeline",id:"como-executar-o-pipeline",level:3}];function c(e){const a={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a.header,{children:(0,n.jsx)(a.h1,{id:"documenta\xe7\xe3o-t\xe9cnica-pipeline-de-ingest\xe3o-de-artigos-etl-blog",children:"Documenta\xe7\xe3o T\xe9cnica: Pipeline de Ingest\xe3o de Artigos (ETL Blog)"})}),"\n",(0,n.jsx)(a.h2,{id:"1-vis\xe3o-geral",children:"1. Vis\xe3o Geral"}),"\n",(0,n.jsxs)(a.p,{children:["Este subsistema \xe9 respons\xe1vel por extrair, limpar e estruturar o conte\xfado t\xe9cnico do Blog da Contabilizei. O objetivo \xe9 transformar p\xe1ginas HTML n\xe3o estruturadas em arquivos ",(0,n.jsx)(a.strong,{children:"Markdown de alta fidelidade"}),", preservando tabelas tribut\xe1rias, datas de atualiza\xe7\xe3o e links de v\xeddeo, para alimentar a base de conhecimento do sistema RAG."]}),"\n",(0,n.jsxs)(a.p,{children:["A solu\xe7\xe3o utiliza uma abordagem ",(0,n.jsx)(a.strong,{children:"h\xedbrida"}),": processamento Python para limpeza pesada e extra\xe7\xe3o de metadados, combinado com LLM para estrutura\xe7\xe3o sem\xe2ntica."]}),"\n",(0,n.jsx)(a.hr,{}),"\n",(0,n.jsx)(a.h2,{id:"2-arquitetura-e-fluxo-de-dados",children:"2. Arquitetura e Fluxo de Dados"}),"\n",(0,n.jsxs)(a.p,{children:["O pipeline opera em lote (",(0,n.jsx)(a.em,{children:"batch processing"}),"), lendo URLs de uma planilha e gerando arquivos organizados por diret\xf3rios."]}),"\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.img,{alt:"Fluxo de Dados",src:o(1692).A+"",width:"3472",height:"5165"}),"\n",(0,n.jsx)(a.em,{children:"Figura 1: Arquitetura L\xf3gica do Pipeline de Blog"})]}),"\n",(0,n.jsx)(a.h3,{id:"o-fluxo-passo-a-passo",children:"O Fluxo Passo a Passo:"}),"\n",(0,n.jsxs)(a.ol,{children:["\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Ingest\xe3o:"})," O orquestrador l\xea o arquivo ",(0,n.jsx)(a.code,{children:"urls_blog.csv"}),"."]}),"\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Request & Valida\xe7\xe3o:"})," Verifica se a URL \xe9 v\xe1lida e se a p\xe1gina est\xe1 acess\xedvel (Status 200)."]}),"\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Extra\xe7\xe3o de Metadados (Python):"}),' Antes de limpar o HTML, o script busca a "Fonte da Verdade" da data (',(0,n.jsx)(a.code,{children:"article:modified_time"}),") nos metadados da p\xe1gina."]}),"\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Limpeza de DOM (Python):"})," Remove elementos de UI, banners, calculadoras e menus que poluem o contexto."]}),"\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Estrutura\xe7\xe3o Sem\xe2ntica (LLM):"})," O HTML limpo \xe9 enviado ao GPT-4o-mini, que converte o conte\xfado para Markdown, garantindo que tabelas HTML complexas sejam transformadas corretamente."]}),"\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Persist\xeancia:"})," O Markdown gerado \xe9 salvo com um cabe\xe7alho YAML (Frontmatter) rico em metadados."]}),"\n"]}),"\n",(0,n.jsx)(a.hr,{}),"\n",(0,n.jsx)(a.h2,{id:"3-l\xf3gica-e-decis\xf5es-t\xe9cnicas",children:"3. L\xf3gica e Decis\xf5es T\xe9cnicas"}),"\n",(0,n.jsx)(a.h3,{id:"31-abordagem-h\xedbrida-python--llm",children:"3.1. Abordagem H\xedbrida (Python + LLM)"}),"\n",(0,n.jsx)(a.p,{children:"Optamos por n\xe3o enviar o HTML bruto diretamente para a LLM, nem usar apenas scrapers tradicionais."}),"\n",(0,n.jsxs)(a.ul,{children:["\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Python (BeautifulSoup):"})," \xc9 usado para limpar o HTML bruto. Removemos scripts, estilos e menus de navega\xe7\xe3o programaticamente. Isso reduz o consumo de tokens e o custo da API."]}),"\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"LLM (GPT-4o-mini):"})," \xc9 usada especificamente para ",(0,n.jsx)(a.strong,{children:"formata\xe7\xe3o"}),". Scrapers comuns falham ao converter tabelas complexas (como Anexos do Simples Nacional). A LLM entende a estrutura visual da tabela HTML e a transcreve perfeitamente para Markdown."]}),"\n"]}),"\n",(0,n.jsx)(a.h3,{id:"32-preserva\xe7\xe3o-da-data-de-atualiza\xe7\xe3o",children:"3.2. Preserva\xe7\xe3o da Data de Atualiza\xe7\xe3o"}),"\n",(0,n.jsx)(a.p,{children:"A data vis\xedvel no texto do blog nem sempre \xe9 confi\xe1vel ou f\xe1cil de capturar via Regex (formatos variados)."}),"\n",(0,n.jsxs)(a.ul,{children:["\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Solu\xe7\xe3o:"})," Extra\xedmos a data diretamente da meta-tag ",(0,n.jsx)(a.code,{children:'<meta property="article:modified_time">'}),'. Voc\xea consegue verificar a sua exist\xeancia a partir do script "inspect_html.py".']}),"\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Por que:"})," Isso garante que o RAG saiba exatamente a data da informa\xe7\xe3o fiscal. Se a LLM alucinar uma data no texto, o script Python sobrescreve com a data real do metadado."]}),"\n"]}),"\n",(0,n.jsx)(a.h3,{id:"33-idempot\xeancia-smart-resume",children:"3.3. Idempot\xeancia (Smart Resume)"}),"\n",(0,n.jsxs)(a.p,{children:["O script verifica se o diret\xf3rio de sa\xedda daquela linha (ex: ",(0,n.jsx)(a.code,{children:"linha_003"}),") j\xe1 existe e cont\xe9m arquivos. Se sim, ele pula o processamento. Isso permite reiniciar o script ap\xf3s falhas de conex\xe3o sem duplicar custos ou arquivos."]}),"\n",(0,n.jsx)(a.hr,{}),"\n",(0,n.jsxs)(a.h2,{id:"4-ferramentas-de-diagn\xf3stico-inspect_htmlpy",children:["4. Ferramentas de Diagn\xf3stico: ",(0,n.jsx)(a.code,{children:"inspect_html.py"})]}),"\n",(0,n.jsxs)(a.p,{children:["Criamos um script auxiliar chamado ",(0,n.jsx)(a.code,{children:"inspect_html.py"})," para garantir a qualidade antes da execu\xe7\xe3o em massa, nele podemos especificar qual \xe9 a URL que queremos inspecionar."]}),"\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:"Para que serve:"}),"\nEle simula a etapa de limpeza do pipeline em uma \xfanica URL e gera dois arquivos locais dentro da pasta debug_html_output:"]}),"\n",(0,n.jsxs)(a.ol,{children:["\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.code,{children:"1_original_full.html"}),": O site como ele \xe9."]}),"\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.code,{children:"2_cleaned_for_llm.html"}),": Exatamente o que ser\xe1 enviado para a LLM."]}),"\n"]}),"\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:"Por que usamos:"}),"\n\xc9 fundamental verificar o arquivo ",(0,n.jsx)(a.code,{children:"2_cleaned_for_llm.html"})," para garantir que n\xe3o removemos conte\xfado \xfatil (como uma tabela importante) ou deixamos lixo (como um banner de propaganda) antes de gastar dinheiro com a API."]}),"\n",(0,n.jsx)(a.hr,{}),"\n",(0,n.jsx)(a.h2,{id:"5-exemplo-de-output",children:"5. Exemplo de Output"}),"\n",(0,n.jsxs)(a.p,{children:["Cada artigo gera um arquivo ",(0,n.jsx)(a.code,{children:".md"})," com Frontmatter (metadados para indexa\xe7\xe3o) e corpo estruturado."]}),"\n",(0,n.jsxs)(a.p,{children:[(0,n.jsx)(a.strong,{children:"Exemplo Real (Linha 003 do CSV):"}),"\n",(0,n.jsxs)(a.em,{children:["Arquivo: ",(0,n.jsx)(a.code,{children:"base_rag_blog/linha_003/blog_Como_pagar_menos_impostos_sendo_PJ_.md"})]})]}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-txt",children:"---\nsource_row: 3\ntitle: \"Como pagar menos impostos sendo PJ?\"\nurl: \"[https://www.contabilizei.com.br/contabilidade-online/como-pagar-menos-impostos-sendo-pj/](https://www.contabilizei.com.br/contabilidade-online/como-pagar-menos-impostos-sendo-pj/)\"\ndate: \"2026-01-13\"\ntags: ['impostos', 'PJ', 'planejamento tribut\xe1rio', 'Simples Nacional', 'Fator-R']\nsummary: \"Este artigo explora estrat\xe9gias para reduzir a carga tribut\xe1ria de pessoas jur\xeddicas (PJ)...\"\nvideos: ['https://www.youtube.com/embed/-Diu9SSMzjg?feature=oembed']\nsource: \"blog_contabilizei\"\nprocessing_date: \"2026-01-21 17:20:21\"\n---\n\n# Como pagar menos impostos sendo PJ?\n\nPara pagar menos impostos como PJ, \xe9 fundamental escolher o regime tribut\xe1rio mais vantajoso...\n\n## O que \xe9 Fator-R?\nO Fator-R \xe9 o c\xe1lculo utilizado para determinar a faixa de tributa\xe7\xe3o de uma empresa...\n\n| Faixa | Al\xedquota | Dedu\xe7\xe3o |\n| :--- | :--- | :--- |\n| 1 | 6% | 0 |\n| 2 | 11.2% | 9.360 |\n\n## V\xeddeos Relacionados\n- [Assistir V\xeddeo](https://www.youtube.com/embed/-Diu9SSMzjg?feature=oembed)\n\n"})}),"\n",(0,n.jsx)(a.h2,{id:"6-guia-de-opera\xe7\xe3o",children:"6. Guia de Opera\xe7\xe3o"}),"\n",(0,n.jsx)(a.h3,{id:"pr\xe9-requisitos",children:"Pr\xe9-requisitos:"}),"\n",(0,n.jsx)(a.p,{children:"Python 3.10+"}),"\n",(0,n.jsx)(a.p,{children:"Arquivo .env na raiz com a chave: OPENAI_API_KEY=sk-..."}),"\n",(0,n.jsx)(a.p,{children:"Arquivo urls_blog.csv presente na pasta do script."}),"\n",(0,n.jsx)(a.h3,{id:"como-executar-o-pipeline",children:"Como Executar o Pipeline"}),"\n",(0,n.jsx)(a.p,{children:"No terminal, execute o script principal:"}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-txt",children:"python etl_blog_pipeline.py\n"})}),"\n",(0,n.jsx)(a.p,{children:"O script exibir\xe1 logs em tempo real:"}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-txt",children:"[PROCESS]: Iniciando uma nova URL.\n[SKIP]: URL j\xe1 processada anteriormente.\n[SUCCESS]: Arquivo Markdown gerado com sucesso.\n"})}),"\n",(0,n.jsx)(a.p,{children:'Podendo ser verificado qualquer erro no relat\xf3rio gerado: "base_rag_blog/relatorio_execucao.md".'}),"\n",(0,n.jsx)(a.p,{children:"Este arquivo lista todas as linhas processadas e o status de cada uma (Sucesso, Erro de Layout, P\xe1gina n\xe3o encontrada, etc)."})]})}function u(e={}){const{wrapper:a}={...(0,i.R)(),...e.components};return a?(0,n.jsx)(a,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},8453:(e,a,o)=>{o.d(a,{R:()=>r,x:()=>t});var s=o(6540);const n={},i=s.createContext(n);function r(e){const a=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function t(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:r(e.components),s.createElement(i.Provider,{value:a},e.children)}}}]);