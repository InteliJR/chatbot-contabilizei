"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[15],{1493:(e,a,o)=>{o.r(a),o.d(a,{assets:()=>d,contentTitle:()=>t,default:()=>u,frontMatter:()=>r,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"Documenta\xe7\xf5es de Desenvolvimento/arquitetura_geral_detalhada","title":"Arquitetura T\xe9cnica do Sistema RAG: Agente de Intelig\xeancia Contabilizei","description":"Esta se\xe7\xe3o descreve o funcionamento l\xf3gico e a infraestrutura do motor de Retrieval-Augmented Generation (RAG) projetado para o Agente de IA da Contabilizei .","source":"@site/docs/Documenta\xe7\xf5es de Desenvolvimento/arquitetura_geral_detalhada.md","sourceDirName":"Documenta\xe7\xf5es de Desenvolvimento","slug":"/Documenta\xe7\xf5es de Desenvolvimento/arquitetura_geral_detalhada","permalink":"/chatbot-contabilizei/docs/Documenta\xe7\xf5es de Desenvolvimento/arquitetura_geral_detalhada","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Documenta\xe7\xe3o T\xe9cnica: Pipeline de Ingest\xe3o de Conhecimento (ETL de Conversas)","permalink":"/chatbot-contabilizei/docs/Documenta\xe7\xf5es de Desenvolvimento/arquitetura_ELT_conversa"},"next":{"title":"Deploy para Google Cloud Run","permalink":"/chatbot-contabilizei/docs/Documenta\xe7\xf5es de Desenvolvimento/deploy"}}');var s=o(4848),i=o(8453);const r={},t="Arquitetura T\xe9cnica do Sistema RAG: Agente de Intelig\xeancia Contabilizei",d={},l=[{value:"1. Contexto dos Dados e Estrat\xe9gia de Ingest\xe3o (ETL)",id:"1-contexto-dos-dados-e-estrat\xe9gia-de-ingest\xe3o-etl",level:2},{value:"As Fontes de Dados",id:"as-fontes-de-dados",level:3},{value:"O Pipeline de Processamento (Batch)",id:"o-pipeline-de-processamento-batch",level:3},{value:"1. Higieniza\xe7\xe3o e Normaliza\xe7\xe3o (Scripts Python)",id:"1-higieniza\xe7\xe3o-e-normaliza\xe7\xe3o-scripts-python",level:4},{value:"2. Staging Area (Cloud Storage)",id:"2-staging-area-cloud-storage",level:4},{value:"3. Estrat\xe9gias de Fragmenta\xe7\xe3o (Chunking Inteligente)",id:"3-estrat\xe9gias-de-fragmenta\xe7\xe3o-chunking-inteligente",level:4},{value:"4. Indexa\xe7\xe3o H\xedbrida (Vertex AI + Firestore)",id:"4-indexa\xe7\xe3o-h\xedbrida-vertex-ai--firestore",level:4},{value:"2. Fluxo de Execu\xe7\xe3o Cognitiva (Runtime)",id:"2-fluxo-de-execu\xe7\xe3o-cognitiva-runtime",level:2},{value:"Camada 1: Seguran\xe7a e Prote\xe7\xe3o (Edge)",id:"camada-1-seguran\xe7a-e-prote\xe7\xe3o-edge",level:3},{value:"Camada 2: Orquestra\xe7\xe3o e Racioc\xednio (Cloud Run)",id:"camada-2-orquestra\xe7\xe3o-e-racioc\xednio-cloud-run",level:3},{value:"Camada 3: Gera\xe7\xe3o e Auditoria",id:"camada-3-gera\xe7\xe3o-e-auditoria",level:3}];function c(e){const a={blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.header,{children:(0,s.jsx)(a.h1,{id:"arquitetura-t\xe9cnica-do-sistema-rag-agente-de-intelig\xeancia-contabilizei",children:"Arquitetura T\xe9cnica do Sistema RAG: Agente de Intelig\xeancia Contabilizei"})}),"\n",(0,s.jsxs)(a.p,{children:["Esta se\xe7\xe3o descreve o funcionamento l\xf3gico e a infraestrutura do motor de ",(0,s.jsx)(a.strong,{children:"Retrieval-Augmented Generation (RAG)"})," projetado para o Agente de IA da Contabilizei ."]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.img,{alt:"Vis\xe3o Geral da Arquitetura",src:o(3428).A+"",width:"15041",height:"2497"}),"\n",(0,s.jsx)(a.em,{children:"Figura 1: Pipeline de Ingest\xe3o de Dados (ETL) \u2013 Demonstra\xe7\xe3o do fluxo desde a coleta das fontes (Blog, Chat, Site) at\xe9 a indexa\xe7\xe3o h\xedbrida no Vertex AI e Firestore."})]}),"\n",(0,s.jsxs)(a.p,{children:["A solu\xe7\xe3o foi arquitetada sobre o ",(0,s.jsx)(a.strong,{children:"Google Cloud Platform (GCP)"})," com foco em tr\xeas pilares: ",(0,s.jsx)(a.strong,{children:"precis\xe3o tribut\xe1ria"}),", ",(0,s.jsx)(a.strong,{children:"seguran\xe7a de dados (LGPD)"})," e ",(0,s.jsx)(a.strong,{children:"efici\xeancia de custo (FinOps)"})," ."]}),"\n",(0,s.jsx)(a.p,{children:"A arquitetura \xe9 dividida em dois grandes fluxos:"}),"\n",(0,s.jsxs)(a.ol,{children:["\n",(0,s.jsx)(a.li,{children:(0,s.jsx)(a.strong,{children:"Pipeline de Ingest\xe3o de Dados (ETL)"})}),"\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.strong,{children:"Fluxo de Execu\xe7\xe3o Cognitiva (Runtime)"})," ."]}),"\n"]}),"\n",(0,s.jsx)(a.hr,{}),"\n",(0,s.jsx)(a.h2,{id:"1-contexto-dos-dados-e-estrat\xe9gia-de-ingest\xe3o-etl",children:"1. Contexto dos Dados e Estrat\xe9gia de Ingest\xe3o (ETL)"}),"\n",(0,s.jsxs)(a.p,{children:["O sistema consome tr\xeas fontes de dados distintas, exigindo estrat\xe9gias de processamento (",(0,s.jsx)(a.em,{children:"Chunking"}),") diferenciadas para maximizar a recupera\xe7\xe3o da informa\xe7\xe3o ."]}),"\n",(0,s.jsx)(a.h3,{id:"as-fontes-de-dados",children:"As Fontes de Dados"}),"\n",(0,s.jsxs)(a.ol,{children:["\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.strong,{children:"Blog Contabilizei (780+ Artigos):"})," Conte\xfado denso e legislativo ."]}),"\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.strong,{children:"Hist\xf3rico de Atendimento (Conversas Reais):"}),' Dados n\xe3o estruturados ("sujos") que representam a voz do cliente .']}),"\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.strong,{children:"Site Institucional:"})," Dados estruturados sobre planos e servi\xe7os ."]}),"\n"]}),"\n",(0,s.jsx)(a.h3,{id:"o-pipeline-de-processamento-batch",children:"O Pipeline de Processamento (Batch)"}),"\n",(0,s.jsxs)(a.p,{children:["O processo de ingest\xe3o n\xe3o ocorre em tempo real, mas via ",(0,s.jsx)(a.strong,{children:"Cloud Run Jobs"})," (processamento em lote), garantindo economia de recursos."]}),"\n",(0,s.jsx)(a.h4,{id:"1-higieniza\xe7\xe3o-e-normaliza\xe7\xe3o-scripts-python",children:"1. Higieniza\xe7\xe3o e Normaliza\xe7\xe3o (Scripts Python)"}),"\n",(0,s.jsxs)(a.p,{children:["Antes de entrar na nuvem, scripts dedicados convertem todas as fontes para o formato ",(0,s.jsx)(a.strong,{children:"Markdown"})," ."]}),"\n",(0,s.jsxs)(a.blockquote,{children:["\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"Justificativa:"})," O Markdown preserva a estrutura sem\xe2ntica (t\xedtulos, negritos) e, crucialmente, mant\xe9m a legibilidade de tabelas tribut\xe1rias, que seriam perdidas em texto puro ."]}),"\n"]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.em,{children:"Nota:"}),' No caso das conversas de chat, utilizamos uma LLM intermedi\xe1ria para extrair pares limpos de Pergunta & Resposta (Q&A), descartando ru\xeddos da conversa ("oi", "bom dia") .']}),"\n",(0,s.jsx)(a.h4,{id:"2-staging-area-cloud-storage",children:"2. Staging Area (Cloud Storage)"}),"\n",(0,s.jsxs)(a.p,{children:["Os arquivos Markdown normalizados s\xe3o depositados em um bucket do ",(0,s.jsx)(a.strong,{children:"Google Cloud Storage"}),' . Isso desacopla a coleta do processamento, criando um "Data Lake" de documentos brutos para auditoria futura .']}),"\n",(0,s.jsx)(a.h4,{id:"3-estrat\xe9gias-de-fragmenta\xe7\xe3o-chunking-inteligente",children:"3. Estrat\xe9gias de Fragmenta\xe7\xe3o (Chunking Inteligente)"}),"\n",(0,s.jsx)(a.p,{children:'O "Ingestion Worker" (Cloud Run Job) l\xea os arquivos e aplica estrat\xe9gias distintas baseadas no tipo de conte\xfado :'}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.strong,{children:"Parent-Child Chunking (Para Blogs/Leis):"}),' O documento \xe9 quebrado em fragmentos pequenos ("Filhos") para a busca vetorial, mas mant\xe9m o v\xednculo com o bloco de texto maior ("Pai").',"\n",(0,s.jsxs)(a.blockquote,{children:["\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"Justificativa:"})," Permite encontrar um trecho espec\xedfico (ex: uma al\xedquota), mas entrega para a IA o par\xe1grafo inteiro (contexto), evitando que exce\xe7\xf5es legais sejam cortadas ."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.strong,{children:"Atomic Chunking (Para Q&A):"}),' O par "Pergunta + Resposta" \xe9 tratado como uma unidade indivis\xedvel .']}),"\n"]}),"\n",(0,s.jsx)(a.h4,{id:"4-indexa\xe7\xe3o-h\xedbrida-vertex-ai--firestore",children:"4. Indexa\xe7\xe3o H\xedbrida (Vertex AI + Firestore)"}),"\n",(0,s.jsx)(a.p,{children:"Adotamos uma arquitetura de separa\xe7\xe3o de responsabilidades para performance extrema :"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.strong,{children:"Vertex AI Vector Search:"})," Armazena apenas os vetores (Embeddings gerados pelo modelo ",(0,s.jsx)(a.code,{children:"text-embedding-3-small"})," da OpenAI). \xc9 otimizado para busca matem\xe1tica de similaridade em milissegundos ."]}),"\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.strong,{children:"Google Firestore:"})," Armazena o conte\xfado textual (Payload) e metadados."]}),"\n"]}),"\n",(0,s.jsx)(a.p,{children:'Quando o Vertex AI encontra o "ID" do vetor mais pr\xf3ximo, o sistema busca o texto completo no Firestore .'}),"\n",(0,s.jsx)(a.hr,{}),"\n",(0,s.jsx)(a.h2,{id:"2-fluxo-de-execu\xe7\xe3o-cognitiva-runtime",children:"2. Fluxo de Execu\xe7\xe3o Cognitiva (Runtime)"}),"\n",(0,s.jsx)(a.p,{children:"Quando um usu\xe1rio envia uma mensagem, o sistema segue um pipeline rigoroso de seguran\xe7a e orquestra\xe7\xe3o antes de gerar qualquer resposta."}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.img,{alt:"Fluxo de Execu\xe7\xe3o e Seguran\xe7a",src:o(5170).A+"",width:"10778",height:"13448"}),"\n",(0,s.jsx)(a.em,{children:"Figura 2: Fluxo de Execu\xe7\xe3o (Runtime) \u2013 Detalhamento das camadas de seguran\xe7a (Edge), classifica\xe7\xe3o de inten\xe7\xe3o e orquestra\xe7\xe3o da resposta via RAG."})]}),"\n",(0,s.jsx)(a.h3,{id:"camada-1-seguran\xe7a-e-prote\xe7\xe3o-edge",children:"Camada 1: Seguran\xe7a e Prote\xe7\xe3o (Edge)"}),"\n",(0,s.jsx)(a.p,{children:"Antes de invocar modelos caros, a requisi\xe7\xe3o passa por filtros de prote\xe7\xe3o :"}),"\n",(0,s.jsxs)(a.ol,{children:["\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.strong,{children:"Rate Limiting (Redis):"})," Bloqueia abusos e ataques DDoS baseados em volume de requisi\xe7\xf5es, protegendo o or\xe7amento."]}),"\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.strong,{children:"PII Masking (DLP):"})," Um middleware intercepta dados sens\xedveis (CPF, Sal\xe1rio, E-mail) e os substitui por tokens seguros (ex: ",(0,s.jsx)(a.code,{children:"<CPF_ID>"}),") .","\n",(0,s.jsxs)(a.blockquote,{children:["\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.strong,{children:"Justificativa:"})," Garante que dados pessoais de clientes nunca sejam enviados para a API da OpenAI, assegurando conformidade total com a LGPD ."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.strong,{children:"Input Guardrails:"}),' Verifica tentativas de "Jailbreak" ou "Prompt Injection" para manipular o comportamento do bot .']}),"\n"]}),"\n",(0,s.jsx)(a.h3,{id:"camada-2-orquestra\xe7\xe3o-e-racioc\xednio-cloud-run",children:"Camada 2: Orquestra\xe7\xe3o e Racioc\xednio (Cloud Run)"}),"\n",(0,s.jsxs)(a.p,{children:['O "C\xe9rebro" do sistema \xe9 uma aplica\xe7\xe3o Python (FastAPI) no ',(0,s.jsx)(a.strong,{children:"Cloud Run"})," :"]}),"\n",(0,s.jsxs)(a.ol,{children:["\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.strong,{children:"Router de Inten\xe7\xe3o:"})," Classifica a pergunta.","\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsx)(a.li,{children:"Se for uma inten\xe7\xe3o de compra, desvia para um fluxo de SDR (Sales Development) para coleta de leads ."}),"\n",(0,s.jsx)(a.li,{children:"Se for t\xe9cnica, aciona o motor RAG ."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.strong,{children:"Recupera\xe7\xe3o (Retrieval):"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsx)(a.li,{children:"Converte a pergunta do usu\xe1rio em vetor (OpenAI)."}),"\n",(0,s.jsxs)(a.li,{children:["Consulta o ",(0,s.jsx)(a.strong,{children:"Vertex AI"})," para obter os IDs dos documentos mais relevantes ."]}),"\n",(0,s.jsxs)(a.li,{children:['Recupera os textos originais ("Pais" ou Respostas de FAQ) no ',(0,s.jsx)(a.strong,{children:"Firestore"})," ."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.strong,{children:"Re-ranking (Cross-Encoder):"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsx)(a.li,{children:"Uma etapa de refinamento onde um modelo especializado reordena os documentos recuperados, garantindo que o topo da lista seja semanticamente preciso para a pergunta fiscal espec\xedfica ."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(a.h3,{id:"camada-3-gera\xe7\xe3o-e-auditoria",children:"Camada 3: Gera\xe7\xe3o e Auditoria"}),"\n",(0,s.jsxs)(a.ol,{children:["\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.strong,{children:"Gera\xe7\xe3o (LLM):"})," O prompt \xe9 montado com o contexto recuperado e enviado ao ",(0,s.jsx)(a.strong,{children:"GPT-4o"}),' . O modelo atua estritamente com base nos dados fornecidos ("Grounding"), minimizando alucina\xe7\xf5es .']}),"\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.strong,{children:"Output Guardrails:"})," A resposta gerada \xe9 verificada contra termos proibidos ou consultoria jur\xeddica indevida ."]}),"\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.strong,{children:"PII Unmasking:"})," Se a resposta for segura, os tokens ",(0,s.jsx)(a.code,{children:"<CPF_ID>"})," s\xe3o revertidos para os dados originais do usu\xe1rio ."]}),"\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.strong,{children:"Traceability:"})," Todo o processo (Prompt, Documentos Usados, Lat\xeancia, Tokens) \xe9 logado no ",(0,s.jsx)(a.strong,{children:"Cloud Logging"})," para auditoria e melhoria cont\xednua ."]}),"\n"]}),"\n",(0,s.jsx)(a.p,{children:"Esta arquitetura garante que a Contabilizei disponha de um agente que n\xe3o apenas responde, mas que opera dentro de limites estritos de seguran\xe7a, conformidade e precis\xe3o t\xe9cnica ."})]})}function u(e={}){const{wrapper:a}={...(0,i.R)(),...e.components};return a?(0,s.jsx)(a,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},3428:(e,a,o)=>{o.d(a,{A:()=>n});const n=o.p+"assets/images/fluxograma_RAG_v2-d641edcaa8588187a07b6f47382fe4e4.png"},5170:(e,a,o)=>{o.d(a,{A:()=>n});const n=o.p+"assets/images/fluxograma_usu\xe1rio_v2-1c79e454874749c7a16d7342be350f82.png"},8453:(e,a,o)=>{o.d(a,{R:()=>r,x:()=>t});var n=o(6540);const s={},i=n.createContext(s);function r(e){const a=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function t(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),n.createElement(i.Provider,{value:a},e.children)}}}]);